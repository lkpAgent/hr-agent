2025-10-02 11:07:32 - app.core.database - ERROR - database - init_db - Error initializing database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:07:32 - main - ERROR - main - lifespan - Failed to initialize database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:12:15 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:12:15 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:02 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:02 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:24 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:30 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:30 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:13:38 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:14:26 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:14:45 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:14:45 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:15:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:15:19 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 11:16:58 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-02 11:17:10 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:04:59 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:05:03 - app.services.knowledge_base_service - ERROR - knowledge_base_service - create_knowledge_base - Error creating knowledge base: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:05:03 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'KnowledgeBaseCreate' object has no attribute 'metadata'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_base.py", line 46, in create_knowledge_base
    knowledge_base = await kb_service.create(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 111, in create
    return await self.create_knowledge_base(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 36, in create_knowledge_base
    meta_data=kb_data.metadata or {}
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:06:20 - app.services.knowledge_base_service - ERROR - knowledge_base_service - create_knowledge_base - Error creating knowledge base: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:06:20 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'KnowledgeBaseCreate' object has no attribute 'metadata'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_base.py", line 46, in create_knowledge_base
    knowledge_base = await kb_service.create(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 111, in create
    return await self.create_knowledge_base(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 36, in create_knowledge_base
    meta_data=kb_data.metadata or {}
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:10:49 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:20:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:27:36 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:27:36 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:27:44 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:27:44 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:31:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:31:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 19:33:09 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:33:09 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:33:53 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'EnhancedDocumentService' object has no attribute 'get_user_documents'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\documents.py", line 29, in get_documents
    documents = await document_service.get_user_documents(
AttributeError: 'EnhancedDocumentService' object has no attribute 'get_user_documents'
2025-10-03 19:35:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:36:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error retrieving documents: 'EnhancedDocumentService' object has no attribute 'get_user_documents'
2025-10-03 19:36:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error retrieving documents: 'EnhancedDocumentService' object has no attribute 'get_user_documents'
2025-10-03 19:37:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:37:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error retrieving documents: 'EnhancedDocumentService' object has no attribute 'get_user_documents'
2025-10-03 19:40:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:41:39 - app.services.enhanced_document_service - ERROR - enhanced_document_service - get_user_documents - Error getting documents for user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.mime_type, documents.content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.uploaded_by_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.uploaded_by_id = $1::UUID AND documents.category = $2::VARCHAR AND documents.knowledge_base_id = $3::UUID ORDER BY documents.created_at DESC 
 LIMIT $4::INTEGER OFFSET $5::INTEGER]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'), 'knowledge', 'cd58e0fd-c2e9-4a02-96a2-3055a474abcd', 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:41:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error retrieving documents: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.mime_type, documents.content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.uploaded_by_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.uploaded_by_id = $1::UUID AND documents.category = $2::VARCHAR AND documents.knowledge_base_id = $3::UUID ORDER BY documents.created_at DESC 
 LIMIT $4::INTEGER OFFSET $5::INTEGER]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'), 'knowledge', 'cd58e0fd-c2e9-4a02-96a2-3055a474abcd', 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 19:41:58 - app.services.knowledge_base_service - ERROR - knowledge_base_service - create_knowledge_base - Error creating knowledge base: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:41:58 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'KnowledgeBaseCreate' object has no attribute 'metadata'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_base.py", line 46, in create_knowledge_base
    knowledge_base = await kb_service.create(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 111, in create
    return await self.create_knowledge_base(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 36, in create_knowledge_base
    meta_data=kb_data.metadata or {}
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:43:28 - app.services.knowledge_base_service - ERROR - knowledge_base_service - create_knowledge_base - Error creating knowledge base: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:43:28 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'KnowledgeBaseCreate' object has no attribute 'metadata'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_base.py", line 46, in create_knowledge_base
    knowledge_base = await kb_service.create(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 111, in create
    return await self.create_knowledge_base(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 36, in create_knowledge_base
    meta_data=kb_data.metadata or {}
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 19:45:38 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 19:46:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:47:20 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'EnhancedDocumentService' object has no attribute 'get_by_id'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\documents.py", line 77, in get_document
    document = await document_service.get_by_id(document_id)
AttributeError: 'EnhancedDocumentService' object has no attribute 'get_by_id'
2025-10-03 19:47:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:47:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: 'EnhancedDocumentService' object has no attribute 'upload_document'
2025-10-03 19:48:50 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Neither 'BinaryExpression' object nor 'Comparator' object has an attribute 'astext'
2025-10-03 19:48:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Neither 'BinaryExpression' object nor 'Comparator' object has an attribute 'astext'
2025-10-03 19:49:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:50:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:52:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 19:52:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 19:52:51 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document(filename='链投产业生态作业V4-20240618.pdf', category='None')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document(filename='链投产业生态作业V4-20240618.pdf', category='None')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document(filename='链投产业生态作业V4-20240618.pdf', category='None')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document(filename='链投产业生态作业V4-20240618.pdf', category='None')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document(filename='链投产业生态作业V4-20240618.pdf', category='None')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document(filename='链投产业生态作业V4-20240618.pdf', category='None')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}

2025-10-03 19:58:40 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document(filename='test_document.txt', category='test')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document(filename='test_document.txt', category='test')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document(filename='test_document.txt', category='test')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document(filename='test_document.txt', category='test')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document(filename='test_document.txt', category='test')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document(filename='test_document.txt', category='test')>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}

2025-10-03 20:00:23 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document at 0x20eb2ba2590>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document at 0x20eb2ba2590>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document at 0x20eb2ba2590>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document at 0x20eb2ba2590>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document at 0x20eb2ba2590>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document at 0x20eb2ba2590>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}

2025-10-03 20:00:52 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document at 0x1cc818364d0>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document at 0x1cc818364d0>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document at 0x1cc818364d0>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 4 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'missing', 'loc': ('response', 'user_id'), 'msg': 'Field required', 'input': <Document at 0x1cc818364d0>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'file_hash'), 'msg': 'Field required', 'input': <Document at 0x1cc818364d0>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}
  {'type': 'missing', 'loc': ('response', 'extracted_content'), 'msg': 'Field required', 'input': <Document at 0x1cc818364d0>, 'url': 'https://errors.pydantic.dev/2.11/v/missing'}

2025-10-03 20:07:20 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column documents.file_hash does not exist
HINT:  Perhaps you meant to reference the column "documents.file_path".
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.file_hash = $1::VARCHAR AND documents.user_id = $2::UUID]
[parameters: ('449af8d77a2f666741ce1b5a173c2ba6ce5835f1d9dda20f845af54a1ebc69c6', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'))]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-03 20:07:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column documents.file_hash does not exist
HINT:  Perhaps you meant to reference the column "documents.file_path".
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.file_hash = $1::VARCHAR AND documents.user_id = $2::UUID]
[parameters: ('449af8d77a2f666741ce1b5a173c2ba6ce5835f1d9dda20f845af54a1ebc69c6', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'))]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-03 20:08:54 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column documents.file_hash does not exist
HINT:  Perhaps you meant to reference the column "documents.file_path".
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.file_hash = $1::VARCHAR AND documents.user_id = $2::UUID]
[parameters: ('449af8d77a2f666741ce1b5a173c2ba6ce5835f1d9dda20f845af54a1ebc69c6', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'))]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-03 20:08:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column documents.file_hash does not exist
HINT:  Perhaps you meant to reference the column "documents.file_path".
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.file_hash = $1::VARCHAR AND documents.user_id = $2::UUID]
[parameters: ('449af8d77a2f666741ce1b5a173c2ba6ce5835f1d9dda20f845af54a1ebc69c6', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'))]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-03 20:11:54 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column documents.extracted_content does not exist
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.file_hash = $1::VARCHAR AND documents.user_id = $2::UUID]
[parameters: ('449af8d77a2f666741ce1b5a173c2ba6ce5835f1d9dda20f845af54a1ebc69c6', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'))]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-03 20:11:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column documents.extracted_content does not exist
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.file_hash = $1::VARCHAR AND documents.user_id = $2::UUID]
[parameters: ('449af8d77a2f666741ce1b5a173c2ba6ce5835f1d9dda20f845af54a1ebc69c6', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'))]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-03 20:14:42 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.CharacterNotInRepertoireError'>: invalid byte sequence for encoding "UTF8": 0x00
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('智慧立法系统解决方案.doc', '智慧立法系统解决方案.doc', 'uploads\\e5b1dc69-0e61-4d8d-8e51-fd662291e8f2\\智慧立法系统解决方案_7f2c4a24.doc', 184832, '7f2c4a249269bc94224d0e4d4b99d8259064dc8ce273af2c4b1dd9d813a78023', 'application/msword', '\x11\u0871\x1a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>\x00\x03\x00\t\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03 ... (241592 characters truncated) ... 0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', '\x11\u0871\x1a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>\x00\x03\x00\t\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03 ... (479 characters truncated) ... 00\x1a\x00\x00\x00\x1b\x00\x00\x00\x1c\x00\x00\x00\x1d\x00\x00\x00\x1e\x00\x00\x00\x1f\x00\x00\x00 \x00\x00\x00!\x00\x00\x00"\x00\x00\x00#\x00\x00...', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[0.23725490196078436,0.11176470588235299,-0.009803921568627472,0.39803921568627454,0.39803921568627454,0.02941176470588236,-0.4019607843137255,-0.127 ... (30537 characters truncated) ... 737473496,0.07723625835913914,-0.1577951774195781,0.2642791091792306,0.2943045477737549,0.35064940510373777,-0.5258582158796163,-0.14305116928950948]', None, '[]', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'), UUID('c740f40f-a6ca-4fd5-8ebb-f0d0997cd29b'), UUID('7062f6cf-aaba-4d35-9032-c34007339126'), datetime.datetime(2025, 10, 3, 12, 14, 42, 441560), datetime.datetime(2025, 10, 3, 12, 14, 42, 441560), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 20:14:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.CharacterNotInRepertoireError'>: invalid byte sequence for encoding "UTF8": 0x00
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('智慧立法系统解决方案.doc', '智慧立法系统解决方案.doc', 'uploads\\e5b1dc69-0e61-4d8d-8e51-fd662291e8f2\\智慧立法系统解决方案_7f2c4a24.doc', 184832, '7f2c4a249269bc94224d0e4d4b99d8259064dc8ce273af2c4b1dd9d813a78023', 'application/msword', '\x11\u0871\x1a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>\x00\x03\x00\t\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03 ... (241592 characters truncated) ... 0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00', '\x11\u0871\x1a\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00>\x00\x03\x00\t\x00\x06\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03 ... (479 characters truncated) ... 00\x1a\x00\x00\x00\x1b\x00\x00\x00\x1c\x00\x00\x00\x1d\x00\x00\x00\x1e\x00\x00\x00\x1f\x00\x00\x00 \x00\x00\x00!\x00\x00\x00"\x00\x00\x00#\x00\x00...', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[0.23725490196078436,0.11176470588235299,-0.009803921568627472,0.39803921568627454,0.39803921568627454,0.02941176470588236,-0.4019607843137255,-0.127 ... (30537 characters truncated) ... 737473496,0.07723625835913914,-0.1577951774195781,0.2642791091792306,0.2943045477737549,0.35064940510373777,-0.5258582158796163,-0.14305116928950948]', None, '[]', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'), UUID('c740f40f-a6ca-4fd5-8ebb-f0d0997cd29b'), UUID('7062f6cf-aaba-4d35-9032-c34007339126'), datetime.datetime(2025, 10, 3, 12, 14, 42, 441560), datetime.datetime(2025, 10, 3, 12, 14, 42, 441560), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 20:19:50 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Unable to serialize unknown type: <class 'app.models.document.Document'>
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 160, in serialize_response
    return field.serialize(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\type_adapter.py", line 572, in dump_python
    return self.serializer.to_python(
pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.document.Document'>
2025-10-03 20:20:28 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Unable to serialize unknown type: <class 'app.models.document.Document'>
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 160, in serialize_response
    return field.serialize(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\type_adapter.py", line 572, in dump_python
    return self.serializer.to_python(
pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.document.Document'>
2025-10-03 20:20:32 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Unable to serialize unknown type: <class 'app.models.document.Document'>
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 160, in serialize_response
    return field.serialize(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\_compat.py", line 147, in serialize
    return self._type_adapter.dump_python(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\type_adapter.py", line 572, in dump_python
    return self.serializer.to_python(
pydantic_core._pydantic_core.PydanticSerializationError: Unable to serialize unknown type: <class 'app.models.document.Document'>
2025-10-03 20:27:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 20:27:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 20:28:10 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 20:28:10 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 20:28:10 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 20:28:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 20:34:48 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 20:34:48 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 20:34:48 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 20:34:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 20:35:28 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 2 validation errors:
  {'type': 'string_type', 'loc': ('response', 5, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
  {'type': 'string_type', 'loc': ('response', 6, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'string_type', 'loc': ('response', 5, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
  {'type': 'string_type', 'loc': ('response', 6, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}

2025-10-03 20:35:33 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 2 validation errors:
  {'type': 'string_type', 'loc': ('response', 5, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
  {'type': 'string_type', 'loc': ('response', 6, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'string_type', 'loc': ('response', 5, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
  {'type': 'string_type', 'loc': ('response', 6, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}

2025-10-03 20:35:37 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 1 validation errors:
  {'type': 'string_type', 'loc': ('response', 1, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'string_type', 'loc': ('response', 1, 'file_hash'), 'msg': 'Input should be a valid string', 'input': None, 'url': 'https://errors.pydantic.dev/2.11/v/string_type'}

2025-10-03 20:44:03 - app.services.llm_service - ERROR - llm_service - summarize_text - Error summarizing text: 'FieldInfo' object is not a mapping
2025-10-03 20:44:03 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 20:44:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 20:44:32 - app.services.llm_service - ERROR - llm_service - summarize_text - Error summarizing text: 'FieldInfo' object is not a mapping
2025-10-03 20:44:32 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 20:44:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 21:05:11 - app.services.llm_service - ERROR - llm_service - summarize_text - Error summarizing text: 'FieldInfo' object is not a mapping
2025-10-03 21:05:11 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 21:05:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 21:06:46 - app.services.llm_service - ERROR - llm_service - summarize_text - Error summarizing text: 'FieldInfo' object is not a mapping
2025-10-03 21:06:46 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 21:06:46 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: 'FieldInfo' object is not a mapping
2025-10-03 21:09:31 - app.services.llm_service - ERROR - llm_service - generate_embedding - Error generating embedding: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:09:31 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:09:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:15:33 - app.services.llm_service - ERROR - llm_service - generate_embedding - Error generating embedding: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:15:33 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:15:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:16:52 - app.services.llm_service - ERROR - llm_service - generate_embedding - Error generating embedding: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:16:52 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:16:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Request URL is missing an 'http://' or 'https://' protocol.
2025-10-03 21:17:42 - app.services.llm_service - ERROR - llm_service - generate_embedding - Embedding API error: 403 - {"error":{"code":"unsupported_country_region_territory","message":"Country, region, or territory not supported","param":null,"type":"request_forbidden"}}
2025-10-03 21:17:42 - app.services.llm_service - ERROR - llm_service - generate_embedding - Error generating embedding: Embedding API error: 403
2025-10-03 21:17:42 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Embedding API error: 403
2025-10-03 21:17:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Embedding API error: 403
2025-10-03 21:18:34 - app.services.llm_service - ERROR - llm_service - generate_embedding - Embedding API error: 403 - {"error":{"code":"unsupported_country_region_territory","message":"Country, region, or territory not supported","param":null,"type":"request_forbidden"}}
2025-10-03 21:18:34 - app.services.llm_service - ERROR - llm_service - generate_embedding - Error generating embedding: Embedding API error: 403
2025-10-03 21:18:34 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Embedding API error: 403
2025-10-03 21:18:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Embedding API error: 403
2025-10-03 21:19:27 - app.services.llm_service - ERROR - llm_service - generate_embedding - Embedding API error: 403 - {"error":{"code":"unsupported_country_region_territory","message":"Country, region, or territory not supported","param":null,"type":"request_forbidden"}}
2025-10-03 21:19:27 - app.services.llm_service - ERROR - llm_service - generate_embedding - Error generating embedding: Embedding API error: 403
2025-10-03 21:19:27 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Embedding API error: 403
2025-10-03 21:19:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Embedding API error: 403
2025-10-03 21:20:56 - app.core.database - ERROR - database - init_db - Error initializing database: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
2025-10-03 21:20:56 - main - ERROR - main - lifespan - Failed to initialize database: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
2025-10-03 21:21:16 - app.core.database - ERROR - database - init_db - Error initializing database: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
2025-10-03 21:21:16 - main - ERROR - main - lifespan - Failed to initialize database: Multiple exceptions: [Errno 10061] Connect call failed ('::1', 5432, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 5432)
2025-10-03 21:25:12 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (builtins.ValueError) expected 1536 dimensions, not 2048
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: [{'mime_type': 'text/plain', 'extracted_content': '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → ... (28879 characters truncated) ... 估。薪酬福利包括结构、待遇及年度评估调整。绩效管理有季度和年度考核，依指标结果用于调薪、晋升等。培训发展含新员工和在职培训，设职业通道。员工关系有沟通、冲突处理和离职管理机制。制度自发布起执行，由人力资源部解释修订。', 'updated_by': None, 'created_by': None}]]
2025-10-03 21:25:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (builtins.ValueError) expected 1536 dimensions, not 2048
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: [{'mime_type': 'text/plain', 'extracted_content': '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → ... (28879 characters truncated) ... 估。薪酬福利包括结构、待遇及年度评估调整。绩效管理有季度和年度考核，依指标结果用于调薪、晋升等。培训发展含新员工和在职培训，设职业通道。员工关系有沟通、冲突处理和离职管理机制。制度自发布起执行，由人力资源部解释修订。', 'updated_by': None, 'created_by': None}]]
2025-10-03 21:27:15 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: expected 1536 dimensions, not 2048
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\e5b1dc69-0e61-4d8d-8e51-fd662291e8f2\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司人力资源管理制度，涵盖多方面内容。总则表明制度目的是规范管理，建立人才机制。招聘管理明确流程、面试标准和试用期。薪酬福利包括结构、待遇及年度评估调整。绩效管理有季度和年度考核，指标多样，结果用于薪酬、晋升等。培训发展分新员工和在职培训，设职业发展通道。员工关系有沟通、冲突处理和离职管理机制。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('3d026bb5-b70d-4f40-b8a8-35a0433203b2'), datetime.datetime(2025, 10, 3, 13, 27, 15, 91582), datetime.datetime(2025, 10, 3, 13, 27, 15, 91582), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 21:27:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: expected 1536 dimensions, not 2048
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\e5b1dc69-0e61-4d8d-8e51-fd662291e8f2\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司人力资源管理制度，涵盖多方面内容。总则表明制度目的是规范管理，建立人才机制。招聘管理明确流程、面试标准和试用期。薪酬福利包括结构、待遇及年度评估调整。绩效管理有季度和年度考核，指标多样，结果用于薪酬、晋升等。培训发展分新员工和在职培训，设职业发展通道。员工关系有沟通、冲突处理和离职管理机制。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('3d026bb5-b70d-4f40-b8a8-35a0433203b2'), datetime.datetime(2025, 10, 3, 13, 27, 15, 91582), datetime.datetime(2025, 10, 3, 13, 27, 15, 91582), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 21:28:42 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司的人力资源管理制度。总则表明制度目的是规范管理，建立人才机制。招聘管理有明确流程、面试标准，新员工试用期3个月并定期评估。薪酬福利含基本工资等，每年评估调整；绩效管理按季度和年度考核，结果用于薪酬等调整。培训发展分新员工和在职培训，有职业发展通道。员工关系方面，有沟通、冲突处理和离职管理机制。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('e3560321-4d04-4211-a2f6-0f6851bbdb21'), datetime.datetime(2025, 10, 3, 13, 28, 42, 391413), datetime.datetime(2025, 10, 3, 13, 28, 42, 391413), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:28:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司的人力资源管理制度。总则表明制度目的是规范管理，建立人才机制。招聘管理有明确流程、面试标准，新员工试用期3个月并定期评估。薪酬福利含基本工资等，每年评估调整；绩效管理按季度和年度考核，结果用于薪酬等调整。培训发展分新员工和在职培训，有职业发展通道。员工关系方面，有沟通、冲突处理和离职管理机制。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('e3560321-4d04-4211-a2f6-0f6851bbdb21'), datetime.datetime(2025, 10, 3, 13, 28, 42, 391413), datetime.datetime(2025, 10, 3, 13, 28, 42, 391413), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:29:23 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司的人力资源管理制度。总则表明制度目的是规范管理，建立人才选拔、培养和激励机制。招聘管理明确流程、面试标准和3个月试用期。薪酬福利含基本工资等结构，有五险一金等福利，每年评估调整。绩效管理按季度和年度考核，依工作质量等指标，结果用于调薪等。培训发展分新员工和在职培训，有职业发展通道。员工关系设沟通、冲突处理和离职管理机制。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('43c5c621-a7e8-4da5-b472-fdc64b6793e9'), datetime.datetime(2025, 10, 3, 13, 29, 23, 590807), datetime.datetime(2025, 10, 3, 13, 29, 23, 590807), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:29:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司的人力资源管理制度。总则表明制度目的是规范管理，建立人才选拔、培养和激励机制。招聘管理明确流程、面试标准和3个月试用期。薪酬福利含基本工资等结构，有五险一金等福利，每年评估调整。绩效管理按季度和年度考核，依工作质量等指标，结果用于调薪等。培训发展分新员工和在职培训，有职业发展通道。员工关系设沟通、冲突处理和离职管理机制。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('43c5c621-a7e8-4da5-b472-fdc64b6793e9'), datetime.datetime(2025, 10, 3, 13, 29, 23, 590807), datetime.datetime(2025, 10, 3, 13, 29, 23, 590807), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:30:33 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本为公司人力资源管理制度，涵盖多方面内容。总则表明制度目的是规范管理、建立人才机制。招聘管理明确流程、面试标准和试用期评估。薪酬福利包括结构、待遇及年度评估调整。绩效管理以季度和年度考核，指标含工作多方面，结果用于薪酬、晋升等。培训发展有新员工和在职培训，设职业发展通道。员工关系建立沟通、冲突处理机制及规范离职流程。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('722e9970-18e9-4274-ab74-19502e838470'), datetime.datetime(2025, 10, 3, 13, 30, 33, 304606), datetime.datetime(2025, 10, 3, 13, 30, 33, 304606), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:30:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本为公司人力资源管理制度，涵盖多方面内容。总则表明制度目的是规范管理、建立人才机制。招聘管理明确流程、面试标准和试用期评估。薪酬福利包括结构、待遇及年度评估调整。绩效管理以季度和年度考核，指标含工作多方面，结果用于薪酬、晋升等。培训发展有新员工和在职培训，设职业发展通道。员工关系建立沟通、冲突处理机制及规范离职流程。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('722e9970-18e9-4274-ab74-19502e838470'), datetime.datetime(2025, 10, 3, 13, 30, 33, 304606), datetime.datetime(2025, 10, 3, 13, 30, 33, 304606), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:32:53 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司人力资源管理制度，涵盖多方面内容。总则表明制度目的是规范管理，建立人才机制。招聘管理明确流程、面试标准和试用期评估。薪酬福利包括结构、待遇及年度评估调整。绩效管理以季度和年度考核，依指标应用结果。培训发展有新员工和在职培训，设职业通道。员工关系方面，有沟通机制、冲突处理及规范离职流程。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('009b33fe-ff08-46e8-8513-f5ba61609837'), datetime.datetime(2025, 10, 3, 13, 32, 53, 97342), datetime.datetime(2025, 10, 3, 13, 32, 53, 97342), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:32:53 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(550e8400-e29b-41d4-a716-446655440000) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, meta_data, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSON, $10, $11::VARCHAR, $12::JSON, $13::UUID, $14::UUID, $15::UUID, $16::TIMESTAMP WITHOUT TIME ZONE, $17::TIMESTAMP WITHOUT TIME ZONE, $18::BOOLEAN, $19::UUID, $20::UUID)]
[parameters: ('hr_policy.txt', 'hr_policy.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\hr_policy_d14a4a82.txt', 1444, 'd14a4a82778021d7fd03675241e6bed191a150431a53975032555f91e7b4b58c', 'text/plain', '\n人力资源管理制度\n\n第一章 总则\n本制度旨在规范公司人力资源管理工作，建立科学的人才选拔、培养和激励机制。\n\n第二章 招聘管理\n1. 招聘流程：需求申请 → 简历筛选 → 面试评估 → 背景调查 → 录用决定\n2. 面试标准：专业能力、沟通能力、团队协作、学习能力\n3. 试用期 ... (272 characters truncated) ... 养、外部培训机会\n3. 职业发展：建立职业发展通道，提供晋升机会\n\n第六章 员工关系\n1. 沟通机制：定期员工座谈会、意见反馈渠道\n2. 冲突处理：建立调解机制，及时处理员工纠纷\n3. 离职管理：规范离职流程，进行离职面谈\n\n本制度自发布之日起执行，由人力资源部负责解释和修订。\n', '该文本是公司人力资源管理制度，涵盖多方面内容。总则表明制度目的是规范管理，建立人才机制。招聘管理明确流程、面试标准和试用期评估。薪酬福利包括结构、待遇及年度评估调整。绩效管理以季度和年度考核，依指标应用结果。培训发展有新员工和在职培训，设职业通道。员工关系方面，有沟通机制、冲突处理及规范离职流程。制度自发布执行，由人力资源部解释修订。', '{"upload_method": "api", "processing_status": "completed", "langchain_processed": true}', '[-0.023908634,0.047036745,-0.017520674,0.023559453,-0.021628687,-0.022388669,-0.00656255,-0.020653034,0.0089246575,0.024093494,0.0023248785,-0.017962 ... (25451 characters truncated) ... .019061178,0.002170828,0.0061003985,-0.004570164,0.03530837,-0.022183267,0.011030014,-0.007425233,-0.003453298,-0.007189022,0.022142189,0.0024609563]', 'knowledge', '[]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('550e8400-e29b-41d4-a716-446655440000'), UUID('009b33fe-ff08-46e8-8513-f5ba61609837'), datetime.datetime(2025, 10, 3, 13, 32, 53, 97342), datetime.datetime(2025, 10, 3, 13, 32, 53, 97342), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 21:33:42 - app.core.database - ERROR - database - init_db - Error initializing database: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR]
[parameters: ('userrole', 'pg_catalog')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 21:33:42 - main - ERROR - main - lifespan - Failed to initialize database: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR]
[parameters: ('userrole', 'pg_catalog')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 21:40:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:40:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:40:43 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:40:46 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:50:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: EnhancedDocumentService.upload_document() missing 1 required positional argument: 'filename'
2025-10-03 21:50:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: EnhancedDocumentService.upload_document() missing 1 required positional argument: 'filename'
2025-10-03 21:50:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: EnhancedDocumentService.upload_document() missing 1 required positional argument: 'filename'
2025-10-03 21:50:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:50:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:50:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:50:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching documents: 'EnhancedDocumentService' object has no attribute 'search_documents'
2025-10-03 21:51:47 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-10-03 21:51:50 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-10-03 21:51:54 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-10-03 21:51:58 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-10-03 21:53:09 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-03 21:53:16 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-03 21:53:24 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-03 21:53:32 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: Failed to create vector extension: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?
connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-03 22:00:08 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 22:00:35 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 22:00:53 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-03 22:01:34 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(d75fcecf-253b-4450-b626-7a3e8490d0da) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9, $10::VARCHAR, $11::JSON, $12::UUID, $13::UUID, $14::UUID, $15::TIMESTAMP WITHOUT TIME ZONE, $16::TIMESTAMP WITHOUT TIME ZONE, $17::BOOLEAN, $18::UUID, $19::UUID)]
[parameters: ('deep_learning_test.txt', 'deep_learning_test.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\deep_learning_test.txt', 342, '3c73311ed479e01ac4d15a44e600f2f274bfde95d2bbf87e6381e757cdc64619', 'text/plain', '\n    这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通常包含多个隐藏层，可以学习复杂的特征表示。\n    ', '这是一份深度学习测试文档。深度学习作为机器学习子领域，借助神经网络模拟人脑学习过程。它应用广泛，涵盖图像识别、自然语言处理和语音识别等领域。其模型一般有多个隐藏层，能够学习复杂的特征表示。', '[-0.009123035949802181,-0.0010998392939483377,-0.006135076766242874,-0.006360299965003626,-0.029140863839657784,0.013681550924719796,-0.0106905884411 ... (43427 characters truncated) ... 0744642440879592,-0.0004215425276805402,-0.0019519333892598475,-0.020972772884601195,-0.029477195837807182,-0.03632397980013402,0.002753727584848123]', 'AI', '["\\u6df1\\u5ea6\\u5b66\\u4e60,\\u795e\\u7ecf\\u7f51\\u7edc"]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('2803d11b-bb7a-4e10-9871-94da7f209ea8'), datetime.datetime(2025, 10, 3, 14, 1, 34, 95485), datetime.datetime(2025, 10, 3, 14, 1, 34, 95485), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 22:01:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(d75fcecf-253b-4450-b626-7a3e8490d0da) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9, $10::VARCHAR, $11::JSON, $12::UUID, $13::UUID, $14::UUID, $15::TIMESTAMP WITHOUT TIME ZONE, $16::TIMESTAMP WITHOUT TIME ZONE, $17::BOOLEAN, $18::UUID, $19::UUID)]
[parameters: ('deep_learning_test.txt', 'deep_learning_test.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\deep_learning_test.txt', 342, '3c73311ed479e01ac4d15a44e600f2f274bfde95d2bbf87e6381e757cdc64619', 'text/plain', '\n    这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通常包含多个隐藏层，可以学习复杂的特征表示。\n    ', '这是一份深度学习测试文档。深度学习作为机器学习子领域，借助神经网络模拟人脑学习过程。它应用广泛，涵盖图像识别、自然语言处理和语音识别等领域。其模型一般有多个隐藏层，能够学习复杂的特征表示。', '[-0.009123035949802181,-0.0010998392939483377,-0.006135076766242874,-0.006360299965003626,-0.029140863839657784,0.013681550924719796,-0.0106905884411 ... (43427 characters truncated) ... 0744642440879592,-0.0004215425276805402,-0.0019519333892598475,-0.020972772884601195,-0.029477195837807182,-0.03632397980013402,0.002753727584848123]', 'AI', '["\\u6df1\\u5ea6\\u5b66\\u4e60,\\u795e\\u7ecf\\u7f51\\u7edc"]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('2803d11b-bb7a-4e10-9871-94da7f209ea8'), datetime.datetime(2025, 10, 3, 14, 1, 34, 95485), datetime.datetime(2025, 10, 3, 14, 1, 34, 95485), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 22:02:40 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(d75fcecf-253b-4450-b626-7a3e8490d0da) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9, $10::VARCHAR, $11::JSON, $12::UUID, $13::UUID, $14::UUID, $15::TIMESTAMP WITHOUT TIME ZONE, $16::TIMESTAMP WITHOUT TIME ZONE, $17::BOOLEAN, $18::UUID, $19::UUID)]
[parameters: ('deep_learning_test.txt', 'deep_learning_test.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\deep_learning_test_1.txt', 342, '3c73311ed479e01ac4d15a44e600f2f274bfde95d2bbf87e6381e757cdc64619', 'text/plain', '\n    这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通常包含多个隐藏层，可以学习复杂的特征表示。\n    ', '这是一篇关于深度学习的测试文档。深度学习是机器学习子领域，借助神经网络模拟人脑学习过程。它应用广泛，涵盖图像识别、自然语言处理和语音识别等领域。其模型一般有多个隐藏层，能够学习复杂的特征表示。', None, 'AI', '["\\u6df1\\u5ea6\\u5b66\\u4e60,\\u795e\\u7ecf\\u7f51\\u7edc"]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('fedb2088-8f7f-42c5-a517-4028dfc700d2'), datetime.datetime(2025, 10, 3, 14, 2, 40, 464348), datetime.datetime(2025, 10, 3, 14, 2, 40, 464348), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 22:02:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: insert or update on table "documents" violates foreign key constraint "documents_knowledge_base_id_fkey"
DETAIL:  Key (knowledge_base_id)=(d75fcecf-253b-4450-b626-7a3e8490d0da) is not present in table "knowledge_bases".
[SQL: INSERT INTO documents (filename, original_filename, file_path, file_size, file_hash, mime_type, extracted_content, summary, embedding, category, tags, user_id, knowledge_base_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9, $10::VARCHAR, $11::JSON, $12::UUID, $13::UUID, $14::UUID, $15::TIMESTAMP WITHOUT TIME ZONE, $16::TIMESTAMP WITHOUT TIME ZONE, $17::BOOLEAN, $18::UUID, $19::UUID)]
[parameters: ('deep_learning_test.txt', 'deep_learning_test.txt', 'uploads\\d75fcecf-253b-4450-b626-7a3e8490d0da\\deep_learning_test_1.txt', 342, '3c73311ed479e01ac4d15a44e600f2f274bfde95d2bbf87e6381e757cdc64619', 'text/plain', '\n    这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通常包含多个隐藏层，可以学习复杂的特征表示。\n    ', '这是一篇关于深度学习的测试文档。深度学习是机器学习子领域，借助神经网络模拟人脑学习过程。它应用广泛，涵盖图像识别、自然语言处理和语音识别等领域。其模型一般有多个隐藏层，能够学习复杂的特征表示。', None, 'AI', '["\\u6df1\\u5ea6\\u5b66\\u4e60,\\u795e\\u7ecf\\u7f51\\u7edc"]', UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('fedb2088-8f7f-42c5-a517-4028dfc700d2'), datetime.datetime(2025, 10, 3, 14, 2, 40, 464348), datetime.datetime(2025, 10, 3, 14, 2, 40, 464348), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 22:03:49 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error creating document chunks: (builtins.ValueError) expected 2048 dimensions, not 0
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BOOLEAN, $11::UUID, $12::UUID)]
[parameters: [{'chunk_size': 119, 'embedding': [], 'content': '这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通 ... (63 characters truncated) ... -8e3c-9a9f1d7b8a8b'), 'chunk_index': 0, 'meta_data': {'filename': 'deep_learning_test.txt', 'category': 'AI'}, 'updated_by': None, 'created_by': None}]]
2025-10-03 22:03:49 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (builtins.ValueError) expected 2048 dimensions, not 0
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BOOLEAN, $11::UUID, $12::UUID)]
[parameters: [{'chunk_size': 119, 'embedding': [], 'content': '这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通 ... (63 characters truncated) ... -8e3c-9a9f1d7b8a8b'), 'chunk_index': 0, 'meta_data': {'filename': 'deep_learning_test.txt', 'category': 'AI'}, 'updated_by': None, 'created_by': None}]]
2025-10-03 22:03:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (builtins.ValueError) expected 2048 dimensions, not 0
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BOOLEAN, $11::UUID, $12::UUID)]
[parameters: [{'chunk_size': 119, 'embedding': [], 'content': '这是一个关于深度学习的测试文档。\n    深度学习是机器学习的一个子领域，使用神经网络来模拟人脑的学习过程。\n    它在图像识别、自然语言处理和语音识别等领域有广泛应用。\n    深度学习模型通 ... (63 characters truncated) ... -8e3c-9a9f1d7b8a8b'), 'chunk_index': 0, 'meta_data': {'filename': 'deep_learning_test.txt', 'category': 'AI'}, 'updated_by': None, 'created_by': None}]]
2025-10-03 22:06:30 - app.services.enhanced_document_service - ERROR - enhanced_document_service - semantic_search - Error in semantic search: (psycopg2.OperationalError) server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.014438262149855503,0.0005016443352065937,-0.010294367106845793,0.04888545350738477,-0.030809205319770404,0.007833041081299558,0.03608428737452077 ... (43449 characters truncated) ... 0.003993259341446255,-0.0036180920375523725,0.05220511654183973,-0.01431320614855754,0.011937146123896287,-0.019861137206139818,0.008071784083777483]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-03 22:06:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 22:06:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 22:20:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 22:20:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 22:20:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 22:20:30 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 22:20:30 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 22:20:30 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 22:20:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 22:20:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error retrieving documents: EnhancedDocumentService.get_user_documents() got an unexpected keyword argument 'knowledge_base_id'
2025-10-03 22:38:38 - app.services.user_service - ERROR - user_service - get_user - Error getting user d75fcecf-253b-4450-b626-7a3e8490d0da: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 22:38:38 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 22:39:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 22:39:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 08:55:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 08:56:04 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 08:56:04 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 08:56:04 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-04 08:56:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-04 09:38:39 - __main__ - ERROR - test_logging_unicode - test_unicode_logging -  Error message with emoji
2025-10-04 10:34:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: 1 validation error for ChatOpenAI
__root__
  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass `openai_api_key` as a named parameter. (type=value_error)
2025-10-04 11:05:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-04 11:06:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-04 11:33:55 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 11:33:55 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 11:33:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 11:33:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 11:35:06 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.027005963,0.08031787,0.032458734,0.014838542,0.036529895,0.031242914,-0.06473325,-0.011992415,0.0018237315,0.047711764,0.017758355,0.00020493951, ... (12577 characters truncated) ... .0049553914,-0.007248872,0.00057538494,-0.021516347,-0.030524474,-0.035571974,-0.010868702,0.02816652,0.016459636,0.0674228,-0.027540186,0.023192706]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:06 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.027005963,0.08031787,0.032458734,0.014838542,0.036529895,0.031242914,-0.06473325,-0.011992415,0.0018237315,0.047711764,0.017758355,0.00020493951, ... (12577 characters truncated) ... .0049553914,-0.007248872,0.00057538494,-0.021516347,-0.030524474,-0.035571974,-0.010868702,0.02816652,0.016459636,0.0674228,-0.027540186,0.023192706]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:11 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.02154508,0.04153803,0.03181872,0.020288592,0.010458418,0.04641616,-0.088841125,0.012454018,-0.034276266,-0.008425863,0.032188278,0.046785716,-0.0 ... (12579 characters truncated) ... 8689172,-0.008425863,-0.007936203,-0.005109104,-0.028049257,-0.035126243,-0.020454893,0.008079405,0.0045478414,0.055248536,-0.011631757,0.0059406036]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.02154508,0.04153803,0.03181872,0.020288592,0.010458418,0.04641616,-0.088841125,0.012454018,-0.034276266,-0.008425863,0.032188278,0.046785716,-0.0 ... (12579 characters truncated) ... 8689172,-0.008425863,-0.007936203,-0.005109104,-0.028049257,-0.035126243,-0.020454893,0.008079405,0.0045478414,0.055248536,-0.011631757,0.0059406036]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:16 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.011678321,0.1115115,0.021471271,-0.016126335,0.048909836,0.04400421,-0.10404323,-0.0155222835,-0.06589649,-0.017718833,0.0047271578,0.034925137,0. ... (12561 characters truncated) ... .0018888038,0.011623408,0.020281473,-0.01295049,-0.016172096,-0.02174584,-0.0059810216,0.0075643673,0.019842165,0.030385602,-0.022514632,0.027310433]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.011678321,0.1115115,0.021471271,-0.016126335,0.048909836,0.04400421,-0.10404323,-0.0155222835,-0.06589649,-0.017718833,0.0047271578,0.034925137,0. ... (12561 characters truncated) ... .0018888038,0.011623408,0.020281473,-0.01295049,-0.016172096,-0.02174584,-0.0059810216,0.0075643673,0.019842165,0.030385602,-0.022514632,0.027310433]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:21 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.013333633,0.09808565,0.020303069,0.03154587,0.0020438333,0.06562275,-0.058689993,-0.015057651,-0.030592158,0.026942374,0.017561147,0.0035305698,- ... (12557 characters truncated) ... 1938,-0.00442009,-0.0058506588,-0.009803063,-8.2102946e-05,-0.03770832,-0.04383409,-0.01824892,0.027144121,0.005566379,0.06709,0.01355372,0.02562185]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.013333633,0.09808565,0.020303069,0.03154587,0.0020438333,0.06562275,-0.058689993,-0.015057651,-0.030592158,0.026942374,0.017561147,0.0035305698,- ... (12557 characters truncated) ... 1938,-0.00442009,-0.0058506588,-0.009803063,-8.2102946e-05,-0.03770832,-0.04383409,-0.01824892,0.027144121,0.005566379,0.06709,0.01355372,0.02562185]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:27 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.03175457,0.06500259,-0.002718553,0.029141022,0.041928723,0.050516084,-0.12970649,-0.0040393267,-0.060634233,0.010108817,-0.018322814,0.010370172, ... (12576 characters truncated) ... 4292821,0.0045433673,-0.021468401,-0.023055196,-0.016792024,-0.0036309601,-0.010566187,0.01217165,-0.0071872477,0.040547278,0.0073739295,0.027778246]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.03175457,0.06500259,-0.002718553,0.029141022,0.041928723,0.050516084,-0.12970649,-0.0040393267,-0.060634233,0.010108817,-0.018322814,0.010370172, ... (12576 characters truncated) ... 4292821,0.0045433673,-0.021468401,-0.023055196,-0.016792024,-0.0036309601,-0.010566187,0.01217165,-0.0071872477,0.040547278,0.0073739295,0.027778246]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:31 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.048340537,0.045440104,0.02513708,-0.023129089,0.062433664,0.018694773,-0.05897546,-0.019317623,0.007729838,0.060760338,0.0081946505,0.015710674,- ... (12528 characters truncated) ... ,0.0068420456,0.009352035,-0.020488951,0.0036696976,-0.02721944,-0.033522304,-0.009026666,0.03333638,0.017067928,0.045923512,-0.01038392,0.033671044]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.048340537,0.045440104,0.02513708,-0.023129089,0.062433664,0.018694773,-0.05897546,-0.019317623,0.007729838,0.060760338,0.0081946505,0.015710674,- ... (12528 characters truncated) ... ,0.0068420456,0.009352035,-0.020488951,0.0036696976,-0.02721944,-0.033522304,-0.009026666,0.03333638,0.017067928,0.045923512,-0.01038392,0.033671044]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:37 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.020536885,0.034826666,0.040774506,-0.013859591,0.024689151,0.023847476,-0.082746066,0.0073880414,-0.029159384,-0.028785305,0.018086674,0.03927819 ... (12599 characters truncated) ... 667644,-0.0017745327,-0.017965099,-0.00028304264,-0.032769237,-0.017750002,-0.007182298,0.018011859,0.020892259,0.036341682,0.0073599857,0.008014622]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.020536885,0.034826666,0.040774506,-0.013859591,0.024689151,0.023847476,-0.082746066,0.0073880414,-0.029159384,-0.028785305,0.018086674,0.03927819 ... (12599 characters truncated) ... 667644,-0.0017745327,-0.017965099,-0.00028304264,-0.032769237,-0.017750002,-0.007182298,0.018011859,0.020892259,0.036341682,0.0073599857,0.008014622]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:43 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.012197879,0.06160619,0.010080511,-0.045992907,0.038664974,0.029072378,-0.07615159,0.0048515336,-0.04901246,-0.021136852,0.047944568,-0.027415307, ... (12521 characters truncated) ... 818,0.0047180476,0.01158108,-0.010688104,-0.01133252,-0.004285368,-0.017564945,0.010439543,0.007889496,0.020455612,0.03231287,-0.002577665,0.0068124]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:43 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.012197879,0.06160619,0.010080511,-0.045992907,0.038664974,0.029072378,-0.07615159,0.0048515336,-0.04901246,-0.021136852,0.047944568,-0.027415307, ... (12521 characters truncated) ... 818,0.0047180476,0.01158108,-0.010688104,-0.01133252,-0.004285368,-0.017564945,0.010439543,0.007889496,0.020455612,0.03231287,-0.002577665,0.0068124]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:50 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.0379289,0.081329025,0.0031260846,0.022679709,0.10424903,0.023234224,-0.10055225,-0.024269322,-0.053418383,0.0046302094,0.024380224,-0.009371322,- ... (12573 characters truncated) ... .0070793224,0.0055266772,-0.0115893865,-0.011755741,-0.03593264,-0.02297545,-0.008363951,0.029740548,-0.007638459,0.04018393,-0.017171515,0.03548903]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.0379289,0.081329025,0.0031260846,0.022679709,0.10424903,0.023234224,-0.10055225,-0.024269322,-0.053418383,0.0046302094,0.024380224,-0.009371322,- ... (12573 characters truncated) ... .0070793224,0.0055266772,-0.0115893865,-0.011755741,-0.03593264,-0.02297545,-0.008363951,0.029740548,-0.007638459,0.04018393,-0.017171515,0.03548903]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:56 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.0021608304,0.056483854,-0.011167559,-0.039132603,0.01085376,0.011785928,-0.08062793,0.0041186144,-0.071804635,-0.019787807,0.043488875,0.008758689 ... (12590 characters truncated) ... ,0.008052641,-0.00843566,0.0027180547,-0.022612,-0.012035121,-0.019529384,0.011988974,0.0077249976,0.0048915753,0.016649816,-0.0068897377,0.03211827]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:35:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 2048 and 1024

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.0021608304,0.056483854,-0.011167559,-0.039132603,0.01085376,0.011785928,-0.08062793,0.0041186144,-0.071804635,-0.019787807,0.043488875,0.008758689 ... (12590 characters truncated) ... ,0.008052641,-0.00843566,0.0027180547,-0.022612,-0.012035121,-0.019529384,0.011988974,0.0077249976,0.0048915753,0.016649816,-0.0068897377,0.03211827]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:17 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.01760477,0.028030694,-0.006120692,0.019710703,0.009642683,-0.016059035,0.0017246865,0.019171251,-0.002510521,0.024192294,0.006167375,-0.009103232 ... (25407 characters truncated) ... .014326569,-0.026453838,0.014087966,-0.011058741,-0.014596294,-0.010078394,0.011401085,0.025955884,-0.026142616,-0.0016079784,0.02049913,-0.01453405]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.01760477,0.028030694,-0.006120692,0.019710703,0.009642683,-0.016059035,0.0017246865,0.019171251,-0.002510521,0.024192294,0.006167375,-0.009103232 ... (25407 characters truncated) ... .014326569,-0.026453838,0.014087966,-0.011058741,-0.014596294,-0.010078394,0.011401085,0.025955884,-0.026142616,-0.0016079784,0.02049913,-0.01453405]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:22 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.012173456,0.009519578,0.013086733,0.023530334,-0.011485811,-0.008633161,-0.030621668,0.04027018,0.015837312,0.018867245,0.033823512,0.0015485431,0 ... (25449 characters truncated) ... 0.03715429,-0.034790512,-0.010787423,0.0053265584,0.013033012,0.008514972,0.0077736056,0.02980509,-0.021231024,0.017545678,0.030707624,-0.0023543765]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:22 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.012173456,0.009519578,0.013086733,0.023530334,-0.011485811,-0.008633161,-0.030621668,0.04027018,0.015837312,0.018867245,0.033823512,0.0015485431,0 ... (25449 characters truncated) ... 0.03715429,-0.034790512,-0.010787423,0.0053265584,0.013033012,0.008514972,0.0077736056,0.02980509,-0.021231024,0.017545678,0.030707624,-0.0023543765]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:26 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.030167898,0.06896124,0.0041118823,-0.019364959,0.016933769,-0.021278199,-0.044141956,-0.013286983,0.018413624,0.024713576,0.014365163,-0.004677398 ... (25572 characters truncated) ... .014777408,-0.03160547,0.02132048,0.009074681,-0.0029676375,-0.012187662,0.0011845445,0.025284378,-0.05585395,0.0015763097,-0.029258845,-0.005792575]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.030167898,0.06896124,0.0041118823,-0.019364959,0.016933769,-0.021278199,-0.044141956,-0.013286983,0.018413624,0.024713576,0.014365163,-0.004677398 ... (25572 characters truncated) ... .014777408,-0.03160547,0.02132048,0.009074681,-0.0029676375,-0.012187662,0.0011845445,0.025284378,-0.05585395,0.0015763097,-0.029258845,-0.005792575]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:31 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.02776538,0.011980669,-0.004171009,0.029377963,-0.008042243,-0.015422914,-0.0060575255,0.005819773,-0.018431002,0.0035585377,0.00041735935,0.01297 ... (25548 characters truncated) ... 055053,-0.020643137,0.024788303,-0.061071433,-0.0022676955,-0.007964715,0.025201786,0.051478628,-0.015381566,0.0030804481,-0.0011680893,-0.025925381]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.02776538,0.011980669,-0.004171009,0.029377963,-0.008042243,-0.015422914,-0.0060575255,0.005819773,-0.018431002,0.0035585377,0.00041735935,0.01297 ... (25548 characters truncated) ... 055053,-0.020643137,0.024788303,-0.061071433,-0.0022676955,-0.007964715,0.025201786,0.051478628,-0.015381566,0.0030804481,-0.0011680893,-0.025925381]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:36 - app.services.rag_service - ERROR - rag_service - search_documents - Error in document search: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.005754086,-0.00555144,-0.016467672,0.019272722,-0.019923324,-0.00974835,-0.005844744,0.024061572,-0.034172554,0.01581707,0.0062660347,0.010521606, ... (25492 characters truncated) ... 20605922,-0.032914013,0.00016798306,0.006591335,0.0044288863,0.014622525,-0.030098297,0.020467268,0.0067406534,-0.016297022,-0.030716902,-0.02418956]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error searching knowledge: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.005754086,-0.00555144,-0.016467672,0.019272722,-0.019923324,-0.00974835,-0.005844744,0.024061572,-0.034172554,0.01581707,0.0062660347,0.010521606, ... (25492 characters truncated) ... 20605922,-0.032914013,0.00016798306,0.006591335,0.0044288863,0.014622525,-0.030098297,0.020467268,0.0067406534,-0.016297022,-0.030716902,-0.02418956]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:41 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.007974126,-0.02988052,-0.006651759,0.010109875,0.012265584,-0.03373285,0.0084282225,0.009411266,-0.011177749,0.034810707,0.01043922,-0.004473595, ... (25418 characters truncated) ... 2,0.028942388,-0.024810612,0.030179923,0.010588922,0.011836438,0.0009443702,0.007999077,0.03233563,-0.016087975,0.011866379,-0.03453126,-0.007854365]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.007974126,-0.02988052,-0.006651759,0.010109875,0.012265584,-0.03373285,0.0084282225,0.009411266,-0.011177749,0.034810707,0.01043922,-0.004473595, ... (25418 characters truncated) ... 2,0.028942388,-0.024810612,0.030179923,0.010588922,0.011836438,0.0009443702,0.007999077,0.03233563,-0.016087975,0.011866379,-0.03453126,-0.007854365]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:47 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.013698675,-0.0039271484,-0.006522482,0.024314173,-0.0005689487,-0.024899585,-0.0013549882,0.033817384,0.0018099033,0.0057224166,0.037544515,-0.005 ... (25484 characters truncated) ... .05557525,-0.019933328,-0.018401496,0.0029856085,-0.0043223025,0.0099178795,0.002375803,0.015718352,-0.032139197,0.007576226,0.02564111,-0.018977152]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.013698675,-0.0039271484,-0.006522482,0.024314173,-0.0005689487,-0.024899585,-0.0013549882,0.033817384,0.0018099033,0.0057224166,0.037544515,-0.005 ... (25484 characters truncated) ... .05557525,-0.019933328,-0.018401496,0.0029856085,-0.0043223025,0.0099178795,0.002375803,0.015718352,-0.032139197,0.007576226,0.02564111,-0.018977152]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:53 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.00097118673,0.025099944,-0.034174092,-0.04229409,-0.028897066,-0.029247569,-0.0036462098,0.00898652,-0.010291172,0.007526089,0.02852709,-0.036238 ... (25387 characters truncated) ... .0149158705,-0.0030279607,0.032518934,0.046383295,0.013679372,0.007350837,-0.003655946,-0.0022478472,-0.02780661,0.02215961,0.020699179,-0.014487478]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:53 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[-0.00097118673,0.025099944,-0.034174092,-0.04229409,-0.028897066,-0.029247569,-0.0036462098,0.00898652,-0.010291172,0.007526089,0.02852709,-0.036238 ... (25387 characters truncated) ... .0149158705,-0.0030279607,0.032518934,0.046383295,0.013679372,0.007350837,-0.003655946,-0.0022478472,-0.02780661,0.02215961,0.020699179,-0.014487478]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:59 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.013049891,0.028611958,-0.021228846,0.03116249,0.012301992,-0.01479499,-0.009147389,0.005489392,-0.039216794,0.0014874096,0.02667509,0.0023719447,0 ... (25515 characters truncated) ... .004293232,-0.027998297,0.006323588,-0.007656384,0.019138562,0.0065393285,-0.01982893,0.01604149,-0.010652777,0.012004749,0.0042860406,-0.0021298362]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:37:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.013049891,0.028611958,-0.021228846,0.03116249,0.012301992,-0.01479499,-0.009147389,0.005489392,-0.039216794,0.0014874096,0.02667509,0.0023719447,0 ... (25515 characters truncated) ... .004293232,-0.027998297,0.006323588,-0.007656384,0.019138562,0.0065393285,-0.01982893,0.01604149,-0.010652777,0.012004749,0.0042860406,-0.0021298362]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:38:05 - app.services.rag_service - ERROR - rag_service - ask_question - Error in RAG question answering: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.018378973,0.017707687,-0.007506188,-0.04609491,-0.03216066,-0.01885701,-0.028051581,0.00030385822,-0.0048744455,0.014910666,0.018165382,-0.0120933 ... (25598 characters truncated) ... .0080757635,-0.0022592305,0.024390025,0.020870864,-0.02010804,0.0030690953,-0.004709167,0.02156249,-0.029516203,0.025915673,0.005492333,-0.036839314]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:38:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: (psycopg2.errors.DataException) different vector dimensions 1024 and 2048

[SQL: SELECT langchain_pg_embedding.id AS langchain_pg_embedding_id, langchain_pg_embedding.collection_id AS langchain_pg_embedding_collection_id, langchain_pg_embedding.embedding AS langchain_pg_embedding_embedding, langchain_pg_embedding.document AS langchain_pg_embedding_document, langchain_pg_embedding.cmetadata AS langchain_pg_embedding_cmetadata, langchain_pg_embedding.embedding <=> %(embedding_1)s AS distance 
FROM langchain_pg_embedding JOIN langchain_pg_collection ON langchain_pg_embedding.collection_id = langchain_pg_collection.uuid 
WHERE langchain_pg_embedding.collection_id = %(collection_id_1)s::UUID ORDER BY distance ASC 
 LIMIT %(param_1)s]
[parameters: {'embedding_1': '[0.018378973,0.017707687,-0.007506188,-0.04609491,-0.03216066,-0.01885701,-0.028051581,0.00030385822,-0.0048744455,0.014910666,0.018165382,-0.0120933 ... (25598 characters truncated) ... .0080757635,-0.0022592305,0.024390025,0.020870864,-0.02010804,0.0030690953,-0.004709167,0.02156249,-0.029516203,0.025915673,0.005492333,-0.036839314]', 'collection_id_1': UUID('fcea507f-4f14-4739-a802-1bdd37070ca5'), 'param_1': 5}]
(Background on this error at: https://sqlalche.me/e/20/9h9h)
2025-10-04 11:40:50 - app.core.database - ERROR - database - init_db - Error initializing database: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR]
[parameters: ('userrole', 'pg_catalog')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 11:40:50 - main - ERROR - main - lifespan - Failed to initialize database: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR]
[parameters: ('userrole', 'pg_catalog')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 11:41:11 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-04 11:41:14 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-04 11:41:17 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-04 11:44:38 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 11:44:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 11:44:38 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 11:44:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 17:03:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-05 12:22:54 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-05 12:22:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-05 12:22:54 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-05 12:22:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-05 12:22:57 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-05 12:23:08 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-05 12:23:35 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-05 12:23:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-05 12:24:19 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-05 12:53:34 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-05 13:04:19 - app.core.database - ERROR - database - init_db - Error initializing database: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR]
[parameters: ('userrole', 'pg_catalog')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 13:04:19 - main - ERROR - main - lifespan - Failed to initialize database: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR]
[parameters: ('userrole', 'pg_catalog')]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 21:38:20 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-10-05 21:38:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-05 21:39:27 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 21:39:27 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 21:39:27 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 21:39:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 21:39:54 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 21:39:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 21:51:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-05 21:51:05 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-05 21:51:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-05 21:51:26 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 21:51:26 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 21:51:26 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 21:51:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 21:51:26 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 21:51:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 21:51:31 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 21:51:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 21:52:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-05 21:54:36 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-05 21:54:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-05 21:54:36 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-05 21:54:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 09:15:30 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 09:15:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 09:15:30 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 09:15:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 09:15:51 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 09:15:51 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 09:15:51 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 09:15:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 09:15:54 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 09:15:54 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 09:15:54 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 09:15:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 09:26:37 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 09:26:37 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 09:26:37 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:06:31 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 10:06:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 10:06:43 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 10:06:43 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 10:07:01 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 10:07:01 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 10:07:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 10:07:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 10:07:23 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:07:23 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:07:23 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 10:07:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 10:15:42 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:15:43 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:15:43 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:36:52 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:36:52 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:36:52 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:37:34 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 10:37:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 10:45:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:45:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 10:45:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:05:56 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:05:56 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:05:56 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:26:09 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:26:09 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:26:09 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:26:09 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:26:09 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:26:09 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:56:14 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 11:56:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 11:56:14 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 11:56:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 11:56:34 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:56:34 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 11:56:34 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 11:56:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 11:56:42 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 11:57:26 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 11:57:29 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 11:57:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 11:57:29 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 11:57:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 11:57:34 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:02:41 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:02:41 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:02:41 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:02:41 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:02:41 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:02:41 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:13:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:13:09 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:13:09 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:13:09 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 12:13:09 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 12:13:10 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:13:10 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 12:13:10 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 12:13:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 12:13:22 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:14:11 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:17:05 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:17:05 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:17:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:20:10 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:38:57 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:39:47 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:39:47 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-06 12:39:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-06 12:40:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-06 12:40:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-06 12:41:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-06 13:25:40 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 13:25:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 13:26:01 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 13:26:01 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 13:26:01 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 13:26:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 17:16:16 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:16:16 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:17:37 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:17:37 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:17:44 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:17:44 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:19:44 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:19:44 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:19:45 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:19:45 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:20:02 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:20:02 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:20:04 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:20:04 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:21:34 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:21:34 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 520, in list_job_descriptions
    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'
2025-10-06 17:22:30 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:22:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:03 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:03 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:04 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:15 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:47 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:47 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:49 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:52 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:23:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:02 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:29 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:29 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:30 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:30 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:41 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:24:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:25:28 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:25:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:25:32 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:25:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column job_descriptions.experience does not exist
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.experience AS experience, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-06 17:31:47 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-06 17:31:56 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-10-06 17:31:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 17:43:04 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:43:04 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:43:04 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:48:37 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 17:48:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 17:48:37 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 17:48:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 17:49:21 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:49:21 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:49:21 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 17:49:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 17:49:27 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:49:27 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 17:49:27 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 17:49:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 18:19:56 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 18:19:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 19:58:21 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 19:58:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 19:58:42 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 19:58:42 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 19:58:42 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 19:58:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 20:39:10 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 20:39:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 20:39:37 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 20:39:37 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 20:39:37 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 20:39:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 20:39:44 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 20:39:44 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 20:39:44 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 20:39:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 21:01:07 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:01:07 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:01:07 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:01:18 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:01:18 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:01:18 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:06:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:06:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:06:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:11:42 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 21:11:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 21:56:05 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 21:56:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 21:56:28 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:56:28 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 21:56:28 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 21:56:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 21:58:34 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 21:58:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 21:58:34 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 21:58:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 22:03:12 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:03:12 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:03:12 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:03:15 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:03:15 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:03:15 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:08:20 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:08:20 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:08:20 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 22:26:55 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:10:15 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 23:10:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 23:10:37 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:10:37 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:10:37 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 23:10:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 23:10:54 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:10:54 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:10:54 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-06 23:10:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-06 23:16:25 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 23:16:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 23:16:25 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-06 23:16:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-06 23:37:46 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:37:46 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:37:46 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:37:50 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-06 23:37:50 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 11:46:27 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 11:46:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 11:46:27 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 11:46:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 11:46:28 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 11:46:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 11:46:49 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'get_by_email'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 32, in register
    existing_user = await user_service.get_by_email(user_data.email)
AttributeError: 'UserService' object has no attribute 'get_by_email'
2025-10-07 11:47:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Email already registered
2025-10-07 11:47:53 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 11:47:53 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 11:48:10 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserCreate' object has no attribute 'username'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 39, in register
    existing_user = await user_service.get_user_by_username(user_data.username)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'UserCreate' object has no attribute 'username'
2025-10-07 11:48:44 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserCreate' object has no attribute 'username'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 39, in register
    existing_user = await user_service.get_user_by_username(user_data.username)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'UserCreate' object has no attribute 'username'
2025-10-07 11:49:37 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserCreate' object has no attribute 'username'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 39, in register
    existing_user = await user_service.get_user_by_username(user_data.username)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'UserCreate' object has no attribute 'username'
2025-10-07 11:52:01 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserCreate' object has no attribute 'username'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 39, in register
    existing_user = await user_service.get_user_by_username(user_data.username)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'UserCreate' object has no attribute 'username'
2025-10-07 11:52:39 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 11:52:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 11:53:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇浠ID煎
2025-10-07 11:53:41 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 4 validation errors for ResumeEvaluationListResponse
items
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
page
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
size
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
pages
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 11:53:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-10-07 11:56:11 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 11:56:12 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 11:56:12 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 11:57:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇浠ID煎
2025-10-07 11:57:04 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 4 validation errors for ResumeEvaluationListResponse
items
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
page
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
size
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
pages
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 11:57:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-10-07 11:57:04 - app.core.logging - ERROR - hr_workflows - save_job_description - Error saving JD: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum jdstatus: "active"
[SQL: INSERT INTO job_descriptions (title, department, location, salary_range, experience_level, education, job_type, skills, content, requirements, status, meta_data, conversation_id, workflow_type, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::JSON, $9::VARCHAR, $10::VARCHAR, $11::jdstatus, $12::JSON, $13::VARCHAR, $14::VARCHAR, $15::UUID, $16::UUID, $17::TIMESTAMP WITHOUT TIME ZONE, $18::TIMESTAMP WITHOUT TIME ZONE, $19::BOOLEAN, $20::UUID, $21::UUID)]
[parameters: ('Python绔寮宸ョ甯', '', '浜', '20-30K', '3-5骞', '绉浠ヤ', 'ㄨ', '["Python", "FastAPI", "PostgreSQL", "Docker"]', '璐璐ｅ绔绯荤寮缁存わ涓绯荤舵璁捐', 'Python寮锛FastAPIDjango缁楠锛浜瑙ｆ版搴璁捐', 'active', 'null', None, 'jd_generation', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('ea68a7b3-48c7-4b42-8ee9-ef41511a65c4'), datetime.datetime(2025, 10, 7, 3, 57, 4, 356553), datetime.datetime(2025, 10, 7, 3, 57, 4, 356553), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 11:57:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 淇瀛JD澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum jdstatus: "active"
[SQL: INSERT INTO job_descriptions (title, department, location, salary_range, experience_level, education, job_type, skills, content, requirements, status, meta_data, conversation_id, workflow_type, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::JSON, $9::VARCHAR, $10::VARCHAR, $11::jdstatus, $12::JSON, $13::VARCHAR, $14::VARCHAR, $15::UUID, $16::UUID, $17::TIMESTAMP WITHOUT TIME ZONE, $18::TIMESTAMP WITHOUT TIME ZONE, $19::BOOLEAN, $20::UUID, $21::UUID)]
[parameters: ('Python绔寮宸ョ甯', '', '浜', '20-30K', '3-5骞', '绉浠ヤ', 'ㄨ', '["Python", "FastAPI", "PostgreSQL", "Docker"]', '璐璐ｅ绔绯荤寮缁存わ涓绯荤舵璁捐', 'Python寮锛FastAPIDjango缁楠锛浜瑙ｆ版搴璁捐', 'active', 'null', None, 'jd_generation', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('ea68a7b3-48c7-4b42-8ee9-ef41511a65c4'), datetime.datetime(2025, 10, 7, 3, 57, 4, 356553), datetime.datetime(2025, 10, 7, 3, 57, 4, 356553), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 11:57:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇浠ID煎
2025-10-07 11:57:51 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 4 validation errors for ResumeEvaluationListResponse
items
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
page
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
size
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
pages
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 11:57:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-10-07 11:59:51 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 4 validation errors for ResumeEvaluationListResponse
items
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
page
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
size
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
pages
  Field required [type=missing, input_value={'evaluations': [], 'tota... 'skip': 0, 'limit': 20}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 11:59:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-10-07 12:00:55 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _call_dify_evaluation - 璋Dify API澶辫触: 'JobDescription' object has no attribute 'company'
2025-10-07 12:00:55 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 'JobDescription' object has no attribute 'company'
2025-10-07 12:00:55 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 'JobDescription' object has no attribute 'company'
2025-10-07 12:00:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 12:01:54 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _call_dify_evaluation - 璋Dify API澶辫触: 'JobDescription' object has no attribute 'experience'
2025-10-07 12:01:54 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 'JobDescription' object has no attribute 'experience'
2025-10-07 12:01:54 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 'JobDescription' object has no attribute 'experience'
2025-10-07 12:01:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 12:02:35 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _call_dify_evaluation - 璋Dify API澶辫触: 'JobDescription' object has no attribute 'experience'
2025-10-07 12:02:35 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 'JobDescription' object has no attribute 'experience'
2025-10-07 12:02:35 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 'JobDescription' object has no attribute 'experience'
2025-10-07 12:02:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 12:03:19 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 1 validation error for EvaluationMetric
max
  Field required [type=missing, input_value={'name': '瀛', 'score...绉浠ヤ瑕姹'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 12:03:19 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _call_dify_evaluation - 璋Dify API澶辫触: 1 validation error for EvaluationMetric
max
  Field required [type=missing, input_value={'name': '缁煎璇浠', ...锛缁洪璁よ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 12:03:19 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 1 validation error for EvaluationMetric
max
  Field required [type=missing, input_value={'name': '缁煎璇浠', ...锛缁洪璁よ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 12:03:19 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: AI璇浠锋℃朵: 1 validation error for EvaluationMetric
max
  Field required [type=missing, input_value={'name': '缁煎璇浠', ...锛缁洪璁よ'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 12:03:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 12:04:18 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: name 'answer' is not defined
2025-10-07 12:04:18 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _save_evaluation_result - 淇瀛璇浠风澶辫触: 'AIEvaluationResult' object has no attribute 'candidate_name'
2025-10-07 12:04:18 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: 'AIEvaluationResult' object has no attribute 'candidate_name'
2025-10-07 12:04:18 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: 'AIEvaluationResult' object has no attribute 'candidate_name'
2025-10-07 12:04:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 12:06:55 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _save_evaluation_result - 淇瀛璇浠风澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "original_filename" of relation "resume_evaluations" violates not-null constraint
DETAIL:  Failing row contains (null, null, null, null, null, null, null, null, null, null, null, null, null, null, c5a1c3b8-652e-4124-a439-bc7f08207bf6, null, null, null, null, b97b640b-aff3-488b-9378-204cb2171a6e, 2025-10-07 04:06:55.277759, 2025-10-07 04:06:55.277759, t, null, null).
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, job_description_id, scoring_criteria_id, conversation_id, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::UUID, $15::UUID, $16::VARCHAR, $17::UUID, $18::UUID, $19::TIMESTAMP WITHOUT TIME ZONE, $20::TIMESTAMP WITHOUT TIME ZONE, $21::BOOLEAN, $22::UUID, $23::UUID)]
[parameters: (None, None, None, None, None, None, None, None, None, None, None, None, None, UUID('c5a1c3b8-652e-4124-a439-bc7f08207bf6'), None, None, None, UUID('b97b640b-aff3-488b-9378-204cb2171a6e'), datetime.datetime(2025, 10, 7, 4, 6, 55, 277759), datetime.datetime(2025, 10, 7, 4, 6, 55, 277759), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-07 12:06:55 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "original_filename" of relation "resume_evaluations" violates not-null constraint
DETAIL:  Failing row contains (null, null, null, null, null, null, null, null, null, null, null, null, null, null, c5a1c3b8-652e-4124-a439-bc7f08207bf6, null, null, null, null, b97b640b-aff3-488b-9378-204cb2171a6e, 2025-10-07 04:06:55.277759, 2025-10-07 04:06:55.277759, t, null, null).
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, job_description_id, scoring_criteria_id, conversation_id, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::UUID, $15::UUID, $16::VARCHAR, $17::UUID, $18::UUID, $19::TIMESTAMP WITHOUT TIME ZONE, $20::TIMESTAMP WITHOUT TIME ZONE, $21::BOOLEAN, $22::UUID, $23::UUID)]
[parameters: (None, None, None, None, None, None, None, None, None, None, None, None, None, UUID('c5a1c3b8-652e-4124-a439-bc7f08207bf6'), None, None, None, UUID('b97b640b-aff3-488b-9378-204cb2171a6e'), datetime.datetime(2025, 10, 7, 4, 6, 55, 277759), datetime.datetime(2025, 10, 7, 4, 6, 55, 277759), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-07 12:06:55 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "original_filename" of relation "resume_evaluations" violates not-null constraint
DETAIL:  Failing row contains (null, null, null, null, null, null, null, null, null, null, null, null, null, null, c5a1c3b8-652e-4124-a439-bc7f08207bf6, null, null, null, null, b97b640b-aff3-488b-9378-204cb2171a6e, 2025-10-07 04:06:55.277759, 2025-10-07 04:06:55.277759, t, null, null).
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, job_description_id, scoring_criteria_id, conversation_id, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::UUID, $15::UUID, $16::VARCHAR, $17::UUID, $18::UUID, $19::TIMESTAMP WITHOUT TIME ZONE, $20::TIMESTAMP WITHOUT TIME ZONE, $21::BOOLEAN, $22::UUID, $23::UUID)]
[parameters: (None, None, None, None, None, None, None, None, None, None, None, None, None, UUID('c5a1c3b8-652e-4124-a439-bc7f08207bf6'), None, None, None, UUID('b97b640b-aff3-488b-9378-204cb2171a6e'), datetime.datetime(2025, 10, 7, 4, 6, 55, 277759), datetime.datetime(2025, 10, 7, 4, 6, 55, 277759), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-07 12:06:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 12:07:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 12 validation errors for ResumeEvaluationResult
id
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
evaluation_metrics
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
total_score
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
name
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
position
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
workYears
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
education
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
age
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
sex
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
school
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
resume_content
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
original_filename
  Field required [type=missing, input_value={'evaluation_id': '3e2765...-10-07T04:07:50.630322'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-07 12:15:45 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 12:15:45 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 12:16:31 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 12:16:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 15:52:25 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 15:52:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 15:52:25 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 15:52:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 15:53:30 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: 
2025-10-07 15:53:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 15:53:49 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: 
2025-10-07 15:53:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-10-07 15:53:51 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 15:53:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 15:53:51 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 15:53:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 15:53:51 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 15:53:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 15:53:52 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 15:53:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 15:53:52 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 15:53:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 16:01:31 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 16:02:08 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 16:02:40 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-07 16:07:24 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 16:07:24 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 16:07:24 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 16:15:21 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 16:15:21 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 16:15:21 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 17:05:40 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:05:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 17:05:40 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:05:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 17:05:41 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:05:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 17:05:41 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:05:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 17:05:41 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:05:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 17:06:15 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:06:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 17:09:45 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 17:09:45 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 17:17:19 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 17:17:19 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 17:17:19 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 17:17:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 20:13:53 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-07 20:13:53 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-07 20:14:33 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:14:33 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:14:33 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 20:14:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 20:18:15 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 20:18:39 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 20:19:11 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-07 20:37:00 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:37:00 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:37:00 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 20:37:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 20:57:37 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:57:37 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:57:37 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:57:37 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:57:37 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 20:57:37 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:02:10 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:02:10 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:02:10 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:02:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-07 21:16:17 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:16:17 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:16:17 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:16:25 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:16:25 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:16:25 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:23:41 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:23:41 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:23:41 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:23:44 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:23:44 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:23:44 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:33:13 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:33:13 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:33:13 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:43:13 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:43:13 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:43:13 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:43:18 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:43:18 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 21:43:18 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:01:48 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:01:48 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:01:48 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-07 22:01:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 22:01:58 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:01:58 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:01:58 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:16:31 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:16:31 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 22:16:31 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-08 09:20:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-08 09:20:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-08 09:20:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-08 09:20:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-08 09:20:26 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-08 09:20:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-08 09:20:26 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-08 09:20:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-08 09:20:47 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-08 09:20:47 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-08 09:20:47 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-08 09:20:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-08 09:32:08 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-10-08 09:32:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-08 09:32:21 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-10-08 09:32:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-08 09:35:35 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-10-08 09:37:43 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-10-09 15:05:11 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 15:05:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 15:05:11 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 15:05:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 15:05:44 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:05:44 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:05:44 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-09 15:05:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-09 15:05:56 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:05:56 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:05:56 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-09 15:05:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-09 15:08:27 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 15:08:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 15:08:27 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 15:08:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 15:23:58 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:23:58 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:23:58 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:23:58 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:23:58 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:23:58 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:36:54 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 15:36:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 15:37:14 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:37:14 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 15:37:14 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-09 15:37:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-09 15:46:49 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-10-09 15:47:06 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-10-09 16:06:18 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:06:18 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:06:18 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:06:18 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:06:18 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:06:18 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:15 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:15 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:15 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:16 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:16 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:16 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:16 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:16 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:14:16 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:28 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 16:23:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 16:23:48 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 16:23:48 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:21:49 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:21:49 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:21:49 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:22:25 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:25 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:25 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:25 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:25 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:26 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:27 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:28 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:28 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:28 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:50 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:51 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:51 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:51 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:51 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:54 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:22:56 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:04 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:06 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:49 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:23:51 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-09 17:30:23 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 17:30:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 17:30:23 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 17:30:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 17:30:41 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:30:41 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:30:41 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:30:43 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:30:43 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 17:30:43 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 18:15:56 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 18:15:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 18:15:56 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 18:15:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 19:12:23 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 19:12:23 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-09 19:12:23 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-09 19:12:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-09 19:12:26 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-09 19:12:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-09 19:12:28 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-09 19:12:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-09 20:48:06 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 20:48:06 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-09 20:48:06 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-09 20:48:06 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 15:00:58 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 15:00:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 15:00:58 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 15:00:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 15:04:24 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 15:04:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 15:04:24 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 15:04:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 15:06:46 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:06:46 - app.services.knowledge_base_service - ERROR - knowledge_base_service - get_by_id - Invalid UUID format: documents
2025-10-10 15:06:46 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Knowledge base not found
2025-10-10 15:06:54 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:06:54 - app.services.knowledge_base_service - ERROR - knowledge_base_service - get_by_id - Invalid UUID format: documents
2025-10-10 15:06:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Knowledge base not found
2025-10-10 15:07:03 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:07:03 - app.services.knowledge_base_service - ERROR - knowledge_base_service - get_by_id - Invalid UUID format: documents
2025-10-10 15:07:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Knowledge base not found
2025-10-10 15:08:21 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:08:21 - app.services.knowledge_base_service - ERROR - knowledge_base_service - get_by_id - Invalid UUID format: documents
2025-10-10 15:08:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Knowledge base not found
2025-10-10 15:10:22 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:10:22 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:10:23 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:10:23 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:09 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:09 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:17 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:17 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:37 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:37 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:59 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:11:59 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:12:09 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:12:09 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:12:53 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:13:09 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 400 - b'{"code": "invalid_param", "message": "exam_1760080388256 is not a valid uuid.", "params": "conversation_id"}\n'
2025-10-10 15:13:09 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-10 15:13:09 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 297, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-10 15:16:20 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-10 15:21:26 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:21:27 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:22:07 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:22:32 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:22:40 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:22:46 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:27:47 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:28:09 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:48:40 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 15:48:40 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 15:48:40 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-10 15:48:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-10 15:51:51 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:52:01 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 15:55:04 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 17:01:18 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:01:18 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:01:18 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:04:04 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 17:04:04 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 17:04:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 17:04:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 17:08:58 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:08:58 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:08:58 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:08:58 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:08:58 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:08:58 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:21:24 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:21:24 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:21:24 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:21:24 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:21:24 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:21:24 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:54:34 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:54:34 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 17:54:34 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:21 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:21 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:21 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:21 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:21 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:21 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:22 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:22 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:22 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:00:31 - app.core.logging - ERROR - hr_workflows - generate_interview_plan_by_resume - Error generating interview plan by resume: 'JobDescription' object has no attribute 'responsibilities'
2025-10-10 18:00:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: ㈣规澶辫触: 'JobDescription' object has no attribute 'responsibilities'
2025-10-10 18:12:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-10 18:14:36 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-10 18:14:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-10 18:14:36 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-10 18:14:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-10 18:14:36 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-10 18:14:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-10 18:14:37 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-10 18:14:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-10 18:14:37 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-10 18:14:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-10 20:24:34 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 20:24:34 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 20:24:34 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 20:26:44 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 20:26:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 20:26:44 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 20:26:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 10:06:48 - app.core.database - ERROR - database - init_db - Error initializing database: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: foreign key constraint "interview_plans_resume_evaluation_id_fkey" cannot be implemented
DETAIL:  Key columns "resume_evaluation_id" and "id" are of incompatible types: integer and uuid.
[SQL: 
CREATE TABLE interview_plans (
	candidate_name VARCHAR(100) NOT NULL, 
	candidate_position VARCHAR(200) NOT NULL, 
	content TEXT NOT NULL, 
	resume_evaluation_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	id UUID NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	created_by UUID, 
	updated_by UUID, 
	PRIMARY KEY (id), 
	FOREIGN KEY(resume_evaluation_id) REFERENCES resume_evaluations (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-11 10:06:48 - main - ERROR - main - lifespan - Failed to initialize database: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: foreign key constraint "interview_plans_resume_evaluation_id_fkey" cannot be implemented
DETAIL:  Key columns "resume_evaluation_id" and "id" are of incompatible types: integer and uuid.
[SQL: 
CREATE TABLE interview_plans (
	candidate_name VARCHAR(100) NOT NULL, 
	candidate_position VARCHAR(200) NOT NULL, 
	content TEXT NOT NULL, 
	resume_evaluation_id INTEGER NOT NULL, 
	user_id INTEGER NOT NULL, 
	id UUID NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	updated_at TIMESTAMP WITHOUT TIME ZONE NOT NULL, 
	is_active BOOLEAN NOT NULL, 
	created_by UUID, 
	updated_by UUID, 
	PRIMARY KEY (id), 
	FOREIGN KEY(resume_evaluation_id) REFERENCES resume_evaluations (id), 
	FOREIGN KEY(user_id) REFERENCES users (id)
)

]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-11 10:09:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 10:09:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 10:09:46 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 10:34:34 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:34:34 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:34:34 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:40:28 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 10:40:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 10:40:28 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 10:40:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 10:41:48 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 10:41:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 10:42:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 10:43:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 10:56:08 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:56:08 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:56:08 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:56:11 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:56:11 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 10:56:11 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 11:13:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 11:13:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 11:13:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 11:13:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 11:13:31 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 11:13:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 11:13:31 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 11:13:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 11:25:17 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 11:25:17 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 11:25:17 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-11 11:25:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-11 11:44:03 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-11 11:44:22 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 11:44:22 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 11:44:22 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 11:44:45 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-11 11:53:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 11:54:38 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 400 - b'{"code": "invalid_param", "message": "exam_1760154877293 is not a valid uuid.", "params": "conversation_id"}\n'
2025-10-11 11:54:38 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 11:54:38 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 298, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 16:28:39 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 16:28:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 16:28:39 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 16:28:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 16:28:41 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-10-11 16:28:41 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.InterfaceError) <class 'asyncpg.exceptions._base.InterfaceError'>: connection is closed
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2025-10-11 16:28:41 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-11 16:28:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-11 16:35:56 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:35:56 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:35:56 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:41:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:41:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:41:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:41:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:41:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 16:41:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:10:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:10:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:10:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:10:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:10:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:10:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:11:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:11:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:11:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:11:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:11:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:11:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:16:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:16:50 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:16:50 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:16:50 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-11 17:16:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-11 17:30:24 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 400 - b'{"code": "invalid_param", "message": "exam_1760175022433 is not a valid uuid.", "params": "conversation_id"}\n'
2025-10-11 17:30:24 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 17:30:24 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 17:30:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-11 17:32:52 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 400 - b'{"code": "invalid_param", "message": "exam_1760175170903 is not a valid uuid.", "params": "conversation_id"}\n'
2025-10-11 17:32:52 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 17:32:52 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 17:46:19 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 400 - b'{"code": "invalid_param", "message": "exam_1760175977278 is not a valid uuid.", "params": "conversation_id"}\n'
2025-10-11 17:46:19 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 17:46:19 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 17:46:22 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:46:22 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:46:22 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:57:07 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 404 - b'{"code": "not_found", "message": "Conversation Not Exists.", "status": 404}\n'
2025-10-11 17:57:07 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 17:57:07 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 21:13:29 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-11 21:13:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-11 21:13:50 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 21:13:50 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 21:13:50 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-11 21:13:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-11 21:14:14 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 404 - b'{"code": "not_found", "message": "Conversation Not Exists.", "status": 404}\n'
2025-10-11 21:14:14 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 21:14:14 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 21:16:39 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 404 - b'{"code": "not_found", "message": "Conversation Not Exists.", "status": 404}\n'
2025-10-11 21:16:39 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 21:16:39 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-12 17:21:04 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:21:04 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:21:04 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:52:19 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:52:19 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:52:19 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:03:10 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:03:10 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:03:10 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:03:19 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:03:19 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:03:19 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:13:07 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 21:13:07 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 21:13:07 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 21:13:07 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 21:25:36 - app.core.logging - ERROR - hr_workflows - get_exam_for_share - Error getting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:25:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:37:41 - app.core.logging - ERROR - hr_workflows - get_exam_for_share - Error getting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:37:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:46:59 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:46:59 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 21:46:59 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 21:46:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 22:04:31 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:04:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:19:02 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $10 in element #1 of executemany() sequence: ['A', 'B'] (expected str, got list)
[SQL: INSERT INTO exam_answer_details (exam_result_id, question_id, question_number, question_type, question_text, question_options, correct_answer, question_explanation, question_score, student_answer, actual_score, is_correct, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::UUID, $2::UUID, $3::INTEGER, $4::VARCHAR, $5::VARCHAR, $6::JSON, $7::VARCHAR, $8::VARCHAR, $9::FLOAT, $10::VARCHAR, $11::FLOAT, $12::VARCHAR, $13::UUID, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE, $16::BOOLEAN, $17::UUID, $18::UUID)]
[parameters: [(UUID('5519c9e6-b2ba-4572-a0aa-4c3808157f70'), UUID('d8f8e768-2ea4-421a-bc82-9c5dd3260307'), 1, '', '婀婀姘存′ㄥ涓骞翠慨璁㈢锛', '[{"id": "A", "text": "2006\\u5e74"}, {"id": "B", "text": "2021\\u5e74"}, {"id": "C", "text": "2025\\u5e74"}, {"id": "D", "text": "2023\\u5e74"}]', '2025骞', '规妗ｅ瀹光2025骞731ユ绗灞浜烘浠ｈ〃澶т甯稿″浼绗涓娆′璁淇璁⑩锛ョ妗涓2025骞淬', 2.0, 'C', 2.0, 'correct', UUID('500ff422-f2b3-4d67-bb91-b04c01f9c4ff'), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), True, None, None), (UUID('5519c9e6-b2ba-4572-a0aa-4c3808157f70'), UUID('7567fe0e-4659-4c23-9ced-5761ea8845bb'), 2, '澶', '跨骇浠ヤ浜烘垮浜ㄩㄩ瑕у璐ｅ濂芥按宸ヤ锛', '[{"id": "A", "text": "\\u53d1\\u5c55\\u548c\\u6539\\u9769\\u90e8\\u95e8"}, {"id": "B", "text": "\\u8d22\\u653f\\u90e8\\u95e8"}, {"id": "C", "text": "\\u4f4f\\u623f\\u548c\\u57ce\\u4e61\\u5efa\\u8bbe\\u90e8\\u95e8"}, {"id": "D", "text": "\\u6559\\u80b2\\u90e8\\u95e8"}]', '灞归╅ㄩ锛璐㈡块ㄩ锛浣垮涔″缓璁鹃ㄩ', '妗ｄ腑扳跨骇浠ヤ浜烘垮灞归┿璐㈡裤浣垮涔″缓璁俱搴ョ＄惰婧澧涓浜ら杩杈涓浠ュ姘璞＄ㄩㄦу璐ｅ濂芥按宸ヤ锛涓查ㄩ锛浠ユｇ‘绛妗灞归╅ㄩㄣ璐㈡块ㄩㄣ浣垮涔″缓璁鹃ㄩㄣ', 3.0, ['A', 'B'], 2.0, 'incorrect', UUID('46c6d021-7bfd-47cb-bb02-d5b2db7d3049'), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), True, None, None), (UUID('5519c9e6-b2ba-4572-a0aa-4c3808157f70'), UUID('a41e48e4-12e1-4c9a-bd2a-2fa8562bbacf'), 3, '绠绛', '板缓瑰缓╁缓姘村╁伐绋濂姘存璁炬藉缓璁炬浜瑕姹锛', '[]', '板缓瑰缓╁缓姘村宸ョ婊娲哄伐绋灞辨椽惧抽叉不宸ョ寮璋姘村伐绋绛姘村╁伐绋搴褰у藉惰瀹濂姘存璁炬藉缓璁撅涓涓讳宸ョ姝ヨ姝ヨ捐°姝ユ藉伐姝ラ讹濂姘存璁炬藉缓璁惧杩琛绠＄缁璐癸绾冲ユ按╁伐绋寤鸿炬绠杩琛绠＄缁璐广姘村╁伐绋濂姘存璁炬藉缓璁剧锛姘磋夸富绠￠ㄩㄥㄧ椤瑰℃ョ搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟哄锋瑙宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按╁伐绋绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹灞ヨ姘存娴绔璁剧璋寸搴', '绛妗渚妗ｄ腑绗＄稿冲瀹广', 5.0, '11', 0.0, 'incorrect', UUID('fc7148fd-458e-4039-a8bf-7755b9357fa0'), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), True, None, None)]]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:19:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $10 in element #1 of executemany() sequence: ['A', 'B'] (expected str, got list)
[SQL: INSERT INTO exam_answer_details (exam_result_id, question_id, question_number, question_type, question_text, question_options, correct_answer, question_explanation, question_score, student_answer, actual_score, is_correct, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::UUID, $2::UUID, $3::INTEGER, $4::VARCHAR, $5::VARCHAR, $6::JSON, $7::VARCHAR, $8::VARCHAR, $9::FLOAT, $10::VARCHAR, $11::FLOAT, $12::VARCHAR, $13::UUID, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE, $16::BOOLEAN, $17::UUID, $18::UUID)]
[parameters: [(UUID('5519c9e6-b2ba-4572-a0aa-4c3808157f70'), UUID('d8f8e768-2ea4-421a-bc82-9c5dd3260307'), 1, '', '婀婀姘存′ㄥ涓骞翠慨璁㈢锛', '[{"id": "A", "text": "2006\\u5e74"}, {"id": "B", "text": "2021\\u5e74"}, {"id": "C", "text": "2025\\u5e74"}, {"id": "D", "text": "2023\\u5e74"}]', '2025骞', '规妗ｅ瀹光2025骞731ユ绗灞浜烘浠ｈ〃澶т甯稿″浼绗涓娆′璁淇璁⑩锛ョ妗涓2025骞淬', 2.0, 'C', 2.0, 'correct', UUID('500ff422-f2b3-4d67-bb91-b04c01f9c4ff'), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), True, None, None), (UUID('5519c9e6-b2ba-4572-a0aa-4c3808157f70'), UUID('7567fe0e-4659-4c23-9ced-5761ea8845bb'), 2, '澶', '跨骇浠ヤ浜烘垮浜ㄩㄩ瑕у璐ｅ濂芥按宸ヤ锛', '[{"id": "A", "text": "\\u53d1\\u5c55\\u548c\\u6539\\u9769\\u90e8\\u95e8"}, {"id": "B", "text": "\\u8d22\\u653f\\u90e8\\u95e8"}, {"id": "C", "text": "\\u4f4f\\u623f\\u548c\\u57ce\\u4e61\\u5efa\\u8bbe\\u90e8\\u95e8"}, {"id": "D", "text": "\\u6559\\u80b2\\u90e8\\u95e8"}]', '灞归╅ㄩ锛璐㈡块ㄩ锛浣垮涔″缓璁鹃ㄩ', '妗ｄ腑扳跨骇浠ヤ浜烘垮灞归┿璐㈡裤浣垮涔″缓璁俱搴ョ＄惰婧澧涓浜ら杩杈涓浠ュ姘璞＄ㄩㄦу璐ｅ濂芥按宸ヤ锛涓查ㄩ锛浠ユｇ‘绛妗灞归╅ㄩㄣ璐㈡块ㄩㄣ浣垮涔″缓璁鹃ㄩㄣ', 3.0, ['A', 'B'], 2.0, 'incorrect', UUID('46c6d021-7bfd-47cb-bb02-d5b2db7d3049'), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), True, None, None), (UUID('5519c9e6-b2ba-4572-a0aa-4c3808157f70'), UUID('a41e48e4-12e1-4c9a-bd2a-2fa8562bbacf'), 3, '绠绛', '板缓瑰缓╁缓姘村╁伐绋濂姘存璁炬藉缓璁炬浜瑕姹锛', '[]', '板缓瑰缓╁缓姘村宸ョ婊娲哄伐绋灞辨椽惧抽叉不宸ョ寮璋姘村伐绋绛姘村╁伐绋搴褰у藉惰瀹濂姘存璁炬藉缓璁撅涓涓讳宸ョ姝ヨ姝ヨ捐°姝ユ藉伐姝ラ讹濂姘存璁炬藉缓璁惧杩琛绠＄缁璐癸绾冲ユ按╁伐绋寤鸿炬绠杩琛绠＄缁璐广姘村╁伐绋濂姘存璁炬藉缓璁剧锛姘磋夸富绠￠ㄩㄥㄧ椤瑰℃ョ搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟哄锋瑙宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按╁伐绋绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹灞ヨ姘存娴绔璁剧璋寸搴', '绛妗渚妗ｄ腑绗＄稿冲瀹广', 5.0, '11', 0.0, 'incorrect', UUID('fc7148fd-458e-4039-a8bf-7755b9357fa0'), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), datetime.datetime(2025, 10, 12, 14, 19, 2, 211023), True, None, None)]]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:19:23 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $10 in element #1 of executemany() sequence: ['A', 'B'] (expected str, got list)
[SQL: INSERT INTO exam_answer_details (exam_result_id, question_id, question_number, question_type, question_text, question_options, correct_answer, question_explanation, question_score, student_answer, actual_score, is_correct, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::UUID, $2::UUID, $3::INTEGER, $4::VARCHAR, $5::VARCHAR, $6::JSON, $7::VARCHAR, $8::VARCHAR, $9::FLOAT, $10::VARCHAR, $11::FLOAT, $12::VARCHAR, $13::UUID, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE, $16::BOOLEAN, $17::UUID, $18::UUID)]
[parameters: [(UUID('02ae8d16-dc62-49a1-bca2-665babdaa49a'), UUID('d8f8e768-2ea4-421a-bc82-9c5dd3260307'), 1, '', '婀婀姘存′ㄥ涓骞翠慨璁㈢锛', '[{"id": "A", "text": "2006\\u5e74"}, {"id": "B", "text": "2021\\u5e74"}, {"id": "C", "text": "2025\\u5e74"}, {"id": "D", "text": "2023\\u5e74"}]', '2025骞', '规妗ｅ瀹光2025骞731ユ绗灞浜烘浠ｈ〃澶т甯稿″浼绗涓娆′璁淇璁⑩锛ョ妗涓2025骞淬', 2.0, 'C', 2.0, 'correct', UUID('723c5a5a-70ea-41a5-982d-6315ba05d142'), datetime.datetime(2025, 10, 12, 14, 19, 23, 182952), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), True, None, None), (UUID('02ae8d16-dc62-49a1-bca2-665babdaa49a'), UUID('7567fe0e-4659-4c23-9ced-5761ea8845bb'), 2, '澶', '跨骇浠ヤ浜烘垮浜ㄩㄩ瑕у璐ｅ濂芥按宸ヤ锛', '[{"id": "A", "text": "\\u53d1\\u5c55\\u548c\\u6539\\u9769\\u90e8\\u95e8"}, {"id": "B", "text": "\\u8d22\\u653f\\u90e8\\u95e8"}, {"id": "C", "text": "\\u4f4f\\u623f\\u548c\\u57ce\\u4e61\\u5efa\\u8bbe\\u90e8\\u95e8"}, {"id": "D", "text": "\\u6559\\u80b2\\u90e8\\u95e8"}]', '灞归╅ㄩ锛璐㈡块ㄩ锛浣垮涔″缓璁鹃ㄩ', '妗ｄ腑扳跨骇浠ヤ浜烘垮灞归┿璐㈡裤浣垮涔″缓璁俱搴ョ＄惰婧澧涓浜ら杩杈涓浠ュ姘璞＄ㄩㄦу璐ｅ濂芥按宸ヤ锛涓查ㄩ锛浠ユｇ‘绛妗灞归╅ㄩㄣ璐㈡块ㄩㄣ浣垮涔″缓璁鹃ㄩㄣ', 3.0, ['A', 'B'], 2.0, 'incorrect', UUID('9052dba4-9b32-4f3d-98dc-1a010777fd8e'), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), True, None, None), (UUID('02ae8d16-dc62-49a1-bca2-665babdaa49a'), UUID('a41e48e4-12e1-4c9a-bd2a-2fa8562bbacf'), 3, '绠绛', '板缓瑰缓╁缓姘村╁伐绋濂姘存璁炬藉缓璁炬浜瑕姹锛', '[]', '板缓瑰缓╁缓姘村宸ョ婊娲哄伐绋灞辨椽惧抽叉不宸ョ寮璋姘村伐绋绛姘村╁伐绋搴褰у藉惰瀹濂姘存璁炬藉缓璁撅涓涓讳宸ョ姝ヨ姝ヨ捐°姝ユ藉伐姝ラ讹濂姘存璁炬藉缓璁惧杩琛绠＄缁璐癸绾冲ユ按╁伐绋寤鸿炬绠杩琛绠＄缁璐广姘村╁伐绋濂姘存璁炬藉缓璁剧锛姘磋夸富绠￠ㄩㄥㄧ椤瑰℃ョ搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟哄锋瑙宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按╁伐绋绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹灞ヨ姘存娴绔璁剧璋寸搴', '绛妗渚妗ｄ腑绗＄稿冲瀹广', 5.0, '11', 0.0, 'incorrect', UUID('9fb6516c-49d6-4bbd-ac63-ef3488a59da1'), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), True, None, None)]]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:19:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $10 in element #1 of executemany() sequence: ['A', 'B'] (expected str, got list)
[SQL: INSERT INTO exam_answer_details (exam_result_id, question_id, question_number, question_type, question_text, question_options, correct_answer, question_explanation, question_score, student_answer, actual_score, is_correct, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::UUID, $2::UUID, $3::INTEGER, $4::VARCHAR, $5::VARCHAR, $6::JSON, $7::VARCHAR, $8::VARCHAR, $9::FLOAT, $10::VARCHAR, $11::FLOAT, $12::VARCHAR, $13::UUID, $14::TIMESTAMP WITHOUT TIME ZONE, $15::TIMESTAMP WITHOUT TIME ZONE, $16::BOOLEAN, $17::UUID, $18::UUID)]
[parameters: [(UUID('02ae8d16-dc62-49a1-bca2-665babdaa49a'), UUID('d8f8e768-2ea4-421a-bc82-9c5dd3260307'), 1, '', '婀婀姘存′ㄥ涓骞翠慨璁㈢锛', '[{"id": "A", "text": "2006\\u5e74"}, {"id": "B", "text": "2021\\u5e74"}, {"id": "C", "text": "2025\\u5e74"}, {"id": "D", "text": "2023\\u5e74"}]', '2025骞', '规妗ｅ瀹光2025骞731ユ绗灞浜烘浠ｈ〃澶т甯稿″浼绗涓娆′璁淇璁⑩锛ョ妗涓2025骞淬', 2.0, 'C', 2.0, 'correct', UUID('723c5a5a-70ea-41a5-982d-6315ba05d142'), datetime.datetime(2025, 10, 12, 14, 19, 23, 182952), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), True, None, None), (UUID('02ae8d16-dc62-49a1-bca2-665babdaa49a'), UUID('7567fe0e-4659-4c23-9ced-5761ea8845bb'), 2, '澶', '跨骇浠ヤ浜烘垮浜ㄩㄩ瑕у璐ｅ濂芥按宸ヤ锛', '[{"id": "A", "text": "\\u53d1\\u5c55\\u548c\\u6539\\u9769\\u90e8\\u95e8"}, {"id": "B", "text": "\\u8d22\\u653f\\u90e8\\u95e8"}, {"id": "C", "text": "\\u4f4f\\u623f\\u548c\\u57ce\\u4e61\\u5efa\\u8bbe\\u90e8\\u95e8"}, {"id": "D", "text": "\\u6559\\u80b2\\u90e8\\u95e8"}]', '灞归╅ㄩ锛璐㈡块ㄩ锛浣垮涔″缓璁鹃ㄩ', '妗ｄ腑扳跨骇浠ヤ浜烘垮灞归┿璐㈡裤浣垮涔″缓璁俱搴ョ＄惰婧澧涓浜ら杩杈涓浠ュ姘璞＄ㄩㄦу璐ｅ濂芥按宸ヤ锛涓查ㄩ锛浠ユｇ‘绛妗灞归╅ㄩㄣ璐㈡块ㄩㄣ浣垮涔″缓璁鹃ㄩㄣ', 3.0, ['A', 'B'], 2.0, 'incorrect', UUID('9052dba4-9b32-4f3d-98dc-1a010777fd8e'), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), True, None, None), (UUID('02ae8d16-dc62-49a1-bca2-665babdaa49a'), UUID('a41e48e4-12e1-4c9a-bd2a-2fa8562bbacf'), 3, '绠绛', '板缓瑰缓╁缓姘村╁伐绋濂姘存璁炬藉缓璁炬浜瑕姹锛', '[]', '板缓瑰缓╁缓姘村宸ョ婊娲哄伐绋灞辨椽惧抽叉不宸ョ寮璋姘村伐绋绛姘村╁伐绋搴褰у藉惰瀹濂姘存璁炬藉缓璁撅涓涓讳宸ョ姝ヨ姝ヨ捐°姝ユ藉伐姝ラ讹濂姘存璁炬藉缓璁惧杩琛绠＄缁璐癸绾冲ユ按╁伐绋寤鸿炬绠杩琛绠＄缁璐广姘村╁伐绋濂姘存璁炬藉缓璁剧锛姘磋夸富绠￠ㄩㄥㄧ椤瑰℃ョ搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟哄锋瑙宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按╁伐绋绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹灞ヨ姘存娴绔璁剧璋寸搴', '绛妗渚妗ｄ腑绗＄稿冲瀹广', 5.0, '11', 0.0, 'incorrect', UUID('9fb6516c-49d6-4bbd-ac63-ef3488a59da1'), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), datetime.datetime(2025, 10, 12, 14, 19, 23, 183949), True, None, None)]]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:27:54 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:27:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:12 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:16 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:16 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:16 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 22:28:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 22:28:18 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:18 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:18 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 22:28:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 22:28:30 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 22:28:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 22:28:32 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:32 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:32 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 22:28:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 22:28:40 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:40 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Exam(exams)]'. Original exception was: Could not determine join condition between parent/child tables on relationship Exam.exam_results - there are no foreign keys linking these tables.  Ensure that referencing columns are associated with a ForeignKey or ForeignKeyConstraint, or specify a 'primaryjoin' expression.
2025-10-12 22:28:40 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 22:28:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 22:31:33 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'get_by_id'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 41, in get_user
    user = await user_service.get_by_id(user_id)
AttributeError: 'UserService' object has no attribute 'get_by_id'
2025-10-12 22:32:35 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: badly formed hexadecimal UUID string
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 42, in get_user
    user = await user_service.get_user(UUID(user_id))
  File "D:\ProgramData\Anaconda3\envs\python310\lib\uuid.py", line 177, in __init__
    raise ValueError('badly formed hexadecimal UUID string')
ValueError: badly formed hexadecimal UUID string
2025-10-12 22:37:33 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: 'Exam' object has no attribute 'time_limit'
2025-10-12 22:37:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: 'Exam' object has no attribute 'time_limit'
2025-10-12 22:39:48 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 22:40:29 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 22:41:24 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: Expecting value: line 1 column 1 (char 0)
2025-10-12 22:41:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: Expecting value: line 1 column 1 (char 0)
2025-10-12 22:42:08 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column "exam_name" of relation "exam_results" does not exist
[SQL: INSERT INTO exam_results (exam_name, student_name, department, total_possible_score, total_actual_score, exam_data, submit_time, status, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::FLOAT, $5::FLOAT, $6::JSON, $7::TIMESTAMP WITHOUT TIME ZONE, $8::VARCHAR, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('22', '娴璇瀛', '', 100.0, 0.0, '{"exam_info": {"exam_id": "1805df8e-65cd-45c8-b8f0-2ba5eb3318e8", "title": "22", "description": null, "total_score": 100.0, "time_limit": 90, "instru ... (6298 characters truncated) ... y": 1.1961313784122467}}, "created_at": 1760280127}, "submit_time": "2025-10-12T14:42:08.665865", "total_actual_score": 0.0, "score_percentage": 0.0}', datetime.datetime(2025, 10, 12, 14, 42, 8, 665865), 'completed', UUID('2ee19f4c-73f7-43c4-b6ac-415677cfe736'), datetime.datetime(2025, 10, 12, 14, 42, 8, 668856), datetime.datetime(2025, 10, 12, 14, 42, 8, 668856), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-12 22:42:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column "exam_name" of relation "exam_results" does not exist
[SQL: INSERT INTO exam_results (exam_name, student_name, department, total_possible_score, total_actual_score, exam_data, submit_time, status, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::FLOAT, $5::FLOAT, $6::JSON, $7::TIMESTAMP WITHOUT TIME ZONE, $8::VARCHAR, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('22', '娴璇瀛', '', 100.0, 0.0, '{"exam_info": {"exam_id": "1805df8e-65cd-45c8-b8f0-2ba5eb3318e8", "title": "22", "description": null, "total_score": 100.0, "time_limit": 90, "instru ... (6298 characters truncated) ... y": 1.1961313784122467}}, "created_at": 1760280127}, "submit_time": "2025-10-12T14:42:08.665865", "total_actual_score": 0.0, "score_percentage": 0.0}', datetime.datetime(2025, 10, 12, 14, 42, 8, 665865), 'completed', UUID('2ee19f4c-73f7-43c4-b6ac-415677cfe736'), datetime.datetime(2025, 10, 12, 14, 42, 8, 668856), datetime.datetime(2025, 10, 12, 14, 42, 8, 668856), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-12 22:45:04 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "exam_id" of relation "exam_results" violates not-null constraint
DETAIL:  Failing row contains (null, 娴璇瀛, , 100, 0, null, null, 2025-10-12 14:45:04.474486, null, null, null, completed, e3e94803-820e-4eae-96fd-69a512363c42, 2025-10-12 14:45:04.476994, 2025-10-12 14:45:04.476994, t, null, null, 22, {"exam_info": {"exam_id": "1805df8e-65cd-45c8-b8f0-2ba5eb3318e8"...).
[SQL: INSERT INTO exam_results (exam_name, student_name, department, total_possible_score, total_actual_score, exam_data, submit_time, status, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::FLOAT, $5::FLOAT, $6::JSON, $7::TIMESTAMP WITHOUT TIME ZONE, $8::VARCHAR, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('22', '娴璇瀛', '', 100.0, 0.0, '{"exam_info": {"exam_id": "1805df8e-65cd-45c8-b8f0-2ba5eb3318e8", "title": "22", "description": null, "total_score": 100.0, "time_limit": 90, "instru ... (6298 characters truncated) ... y": 1.2339927926659584}}, "created_at": 1760280303}, "submit_time": "2025-10-12T14:45:04.474486", "total_actual_score": 0.0, "score_percentage": 0.0}', datetime.datetime(2025, 10, 12, 14, 45, 4, 474486), 'completed', UUID('e3e94803-820e-4eae-96fd-69a512363c42'), datetime.datetime(2025, 10, 12, 14, 45, 4, 476994), datetime.datetime(2025, 10, 12, 14, 45, 4, 476994), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-12 22:45:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "exam_id" of relation "exam_results" violates not-null constraint
DETAIL:  Failing row contains (null, 娴璇瀛, , 100, 0, null, null, 2025-10-12 14:45:04.474486, null, null, null, completed, e3e94803-820e-4eae-96fd-69a512363c42, 2025-10-12 14:45:04.476994, 2025-10-12 14:45:04.476994, t, null, null, 22, {"exam_info": {"exam_id": "1805df8e-65cd-45c8-b8f0-2ba5eb3318e8"...).
[SQL: INSERT INTO exam_results (exam_name, student_name, department, total_possible_score, total_actual_score, exam_data, submit_time, status, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::FLOAT, $5::FLOAT, $6::JSON, $7::TIMESTAMP WITHOUT TIME ZONE, $8::VARCHAR, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('22', '娴璇瀛', '', 100.0, 0.0, '{"exam_info": {"exam_id": "1805df8e-65cd-45c8-b8f0-2ba5eb3318e8", "title": "22", "description": null, "total_score": 100.0, "time_limit": 90, "instru ... (6298 characters truncated) ... y": 1.2339927926659584}}, "created_at": 1760280303}, "submit_time": "2025-10-12T14:45:04.474486", "total_actual_score": 0.0, "score_percentage": 0.0}', datetime.datetime(2025, 10, 12, 14, 45, 4, 474486), 'completed', UUID('e3e94803-820e-4eae-96fd-69a512363c42'), datetime.datetime(2025, 10, 12, 14, 45, 4, 476994), datetime.datetime(2025, 10, 12, 14, 45, 4, 476994), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-12 22:45:26 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "exam_id" of relation "exam_results" violates not-null constraint
DETAIL:  Failing row contains (null, 11, 11, 100, 5, null, null, 2025-10-12 14:45:26.830967, null, null, null, completed, e1ba7a4e-1b38-458f-9623-cb976b3ed013, 2025-10-12 14:45:26.833353, 2025-10-12 14:45:26.833353, t, null, null, 璇2, {"exam_info": {"exam_id": "7c30f896-0dcd-498a-8c0b-2ad2fc4f886b"...).
[SQL: INSERT INTO exam_results (exam_name, student_name, department, total_possible_score, total_actual_score, exam_data, submit_time, status, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::FLOAT, $5::FLOAT, $6::JSON, $7::TIMESTAMP WITHOUT TIME ZONE, $8::VARCHAR, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('璇2', '11', '11', 100.0, 5.0, '{"exam_info": {"exam_id": "7c30f896-0dcd-498a-8c0b-2ad2fc4f886b", "title": "\\u8bd5\\u53772", "description": null, "total_score": 100.0, "time_limit" ... (5881 characters truncated) ... y": 0.8592563569545746}}, "created_at": 1760280326}, "submit_time": "2025-10-12T14:45:26.830967", "total_actual_score": 5.0, "score_percentage": 5.0}', datetime.datetime(2025, 10, 12, 14, 45, 26, 830967), 'completed', UUID('e1ba7a4e-1b38-458f-9623-cb976b3ed013'), datetime.datetime(2025, 10, 12, 14, 45, 26, 833353), datetime.datetime(2025, 10, 12, 14, 45, 26, 833353), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-12 22:45:26 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "exam_id" of relation "exam_results" violates not-null constraint
DETAIL:  Failing row contains (null, 11, 11, 100, 5, null, null, 2025-10-12 14:45:26.830967, null, null, null, completed, e1ba7a4e-1b38-458f-9623-cb976b3ed013, 2025-10-12 14:45:26.833353, 2025-10-12 14:45:26.833353, t, null, null, 璇2, {"exam_info": {"exam_id": "7c30f896-0dcd-498a-8c0b-2ad2fc4f886b"...).
[SQL: INSERT INTO exam_results (exam_name, student_name, department, total_possible_score, total_actual_score, exam_data, submit_time, status, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::FLOAT, $5::FLOAT, $6::JSON, $7::TIMESTAMP WITHOUT TIME ZONE, $8::VARCHAR, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('璇2', '11', '11', 100.0, 5.0, '{"exam_info": {"exam_id": "7c30f896-0dcd-498a-8c0b-2ad2fc4f886b", "title": "\\u8bd5\\u53772", "description": null, "total_score": 100.0, "time_limit" ... (5881 characters truncated) ... y": 0.8592563569545746}}, "created_at": 1760280326}, "submit_time": "2025-10-12T14:45:26.830967", "total_actual_score": 5.0, "score_percentage": 5.0}', datetime.datetime(2025, 10, 12, 14, 45, 26, 830967), 'completed', UUID('e1ba7a4e-1b38-458f-9623-cb976b3ed013'), datetime.datetime(2025, 10, 12, 14, 45, 26, 833353), datetime.datetime(2025, 10, 12, 14, 45, 26, 833353), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-12 22:53:35 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 22:54:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 22:58:27 - app.core.logging - ERROR - hr_workflows - get_exam_for_share - Error getting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '1' (invalid UUID '1': length must be between 32..36 characters, got 1)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('1',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:58:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: '1' (invalid UUID '1': length must be between 32..36 characters, got 1)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('1',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 22:59:03 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 23:00:32 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 23:02:08 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 23:02:37 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-12 23:03:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:03:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:03:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:03:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:04:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:04:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:04:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 23:13:39 - app.core.logging - ERROR - hr_workflows - submit_exam - Error submitting exam: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 23:13:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 浜よ璇澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('7c30f896-0dcd-498a-8c0b-2ad2fc4f886b',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 23:15:20 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 23:15:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 09:39:18 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:39:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:39:36 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:39:36 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:39:36 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 20:45:41 - app.core.database - ERROR - database - init_db - Error initializing database: database "hragent2" does not exist
2025-10-13 20:45:41 - main - ERROR - main - lifespan - Failed to initialize database: database "hragent2" does not exist
2025-11-15 13:18:43 - app.core.database - ERROR - database - init_db - Error initializing database: [WinError 1225] 杩绋璁＄烘缁缃缁杩ャ
2025-11-15 13:18:43 - main - ERROR - main - lifespan - Failed to initialize database: [WinError 1225] 杩绋璁＄烘缁缃缁杩ャ
2025-11-15 16:12:28 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-15 16:12:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-15 16:12:28 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-15 16:12:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-15 16:12:36 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'get_multi'
  + Exception Group Traceback (most recent call last):
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 28, in get_users
    |     users = await user_service.get_multi(skip=skip, limit=limit)
    |                   ^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'UserService' object has no attribute 'get_multi'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 28, in get_users
    users = await user_service.get_multi(skip=skip, limit=limit)
                  ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'UserService' object has no attribute 'get_multi'
2025-11-15 16:12:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-11-15 16:15:45 - app.services.enhanced_document_service - ERROR - enhanced_document_service - delete - Error deleting document: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: update or delete on table "documents" violates foreign key constraint "document_chunks_document_id_fkey" on table "document_chunks"
DETAIL:  Key (id)=(eea9005c-e007-4e1d-b62c-5cf5180be419) is still referenced from table "document_chunks".
[SQL: DELETE FROM documents WHERE documents.id = $1::UUID]
[parameters: (UUID('eea9005c-e007-4e1d-b62c-5cf5180be419'),)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-11-15 16:15:45 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: update or delete on table "documents" violates foreign key constraint "document_chunks_document_id_fkey" on table "document_chunks"
DETAIL:  Key (id)=(eea9005c-e007-4e1d-b62c-5cf5180be419) is still referenced from table "document_chunks".
[SQL: DELETE FROM documents WHERE documents.id = $1::UUID]
[parameters: (UUID('eea9005c-e007-4e1d-b62c-5cf5180be419'),)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 267, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\prepared_stmt.py", line 256, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 206, in bind_execute
asyncpg.exceptions.ForeignKeyViolationError: update or delete on table "documents" violates foreign key constraint "document_chunks_document_id_fkey" on table "document_chunks"
DETAIL:  Key (id)=(eea9005c-e007-4e1d-b62c-5cf5180be419) is still referenced from table "document_chunks".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.ForeignKeyViolationError'>: update or delete on table "documents" violates foreign key constraint "document_chunks_document_id_fkey" on table "document_chunks"
DETAIL:  Key (id)=(eea9005c-e007-4e1d-b62c-5cf5180be419) is still referenced from table "document_chunks".

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\documents.py", line 163, in delete_document
    await document_service.delete(document)
  File "E:\workspace-py\hr-agent\backend\app\services\enhanced_document_service.py", line 629, in delete
    await self.db.commit()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 679, in execute
    util.preloaded.orm_persistence.delete_obj(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 193, in delete_obj
    _emit_delete_statements(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1471, in _emit_delete_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.ForeignKeyViolationError'>: update or delete on table "documents" violates foreign key constraint "document_chunks_document_id_fkey" on table "document_chunks"
DETAIL:  Key (id)=(eea9005c-e007-4e1d-b62c-5cf5180be419) is still referenced from table "document_chunks".
[SQL: DELETE FROM documents WHERE documents.id = $1::UUID]
[parameters: (UUID('eea9005c-e007-4e1d-b62c-5cf5180be419'),)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-11-15 17:01:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-11-15 17:01:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-11-15 17:03:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-11-15 17:07:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 瑕瓒绾х＄瑙
2025-11-15 17:07:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 瑕瓒绾х＄瑙
2025-11-15 17:07:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 瑕瓒绾х＄瑙
2025-11-15 17:07:38 - app.services.user_service - ERROR - user_service - list_user_roles - Error listing roles for user 45d97b38-bd3c-4b3b-9131-6146582a2649: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-11-15 17:07:38 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 132, in admin_list_user_roles
    roles = await role_service.list_user_roles(UUID(user_id))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 373, in list_user_roles
    return user.roles
           ^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1141, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2358, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-11-15 17:07:53 - app.services.user_service - ERROR - user_service - list_user_roles - Error listing roles for user 45d97b38-bd3c-4b3b-9131-6146582a2649: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-11-15 17:07:53 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 132, in admin_list_user_roles
    roles = await role_service.list_user_roles(UUID(user_id))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 373, in list_user_roles
    return user.roles
           ^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1141, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2358, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-11-15 17:11:19 - app.services.user_service - ERROR - user_service - list_user_roles - Error listing roles for user 45d97b38-bd3c-4b3b-9131-6146582a2649: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-11-15 17:11:19 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 132, in admin_list_user_roles
    roles = await role_service.list_user_roles(UUID(user_id))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 373, in list_user_roles
    .order_by(desc(Role.created_at))
       ^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\strategies.py", line 1141, in _emit_lazyload
    result = session.execute(
             ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2358, in _handle_dbapi_exception
    raise exc_info[1].with_traceback(exc_info[2])
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 123, in await_only
    raise exc.MissingGreenlet(
sqlalchemy.exc.MissingGreenlet: greenlet_spawn has not been called; can't call await_only() here. Was IO attempted in an unexpected place? (Background on this error at: https://sqlalche.me/e/20/xd2s)
2025-11-15 17:12:44 - app.services.user_service - ERROR - user_service - assign_roles_to_user - Error assigning roles to user 45d97b38-bd3c-4b3b-9131-6146582a2649: 'RoleService' object has no attribute 'get_user'
2025-11-15 17:12:44 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'RoleService' object has no attribute 'get_user'
  + Exception Group Traceback (most recent call last):
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 144, in admin_assign_user_roles
    |     roles = await role_service.assign_roles_to_user(UUID(user_id), payload.role_ids)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 383, in assign_roles_to_user
    |     if not await self.get_user(user_id):
    |                  ^^^^^^^^^^^^^
    | AttributeError: 'RoleService' object has no attribute 'get_user'
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 144, in admin_assign_user_roles
    roles = await role_service.assign_roles_to_user(UUID(user_id), payload.role_ids)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 383, in assign_roles_to_user
    if not await self.get_user(user_id):
                 ^^^^^^^^^^^^^
AttributeError: 'RoleService' object has no attribute 'get_user'
2025-11-15 17:18:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-11-15 17:18:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-11-15 17:19:16 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-11-15 17:23:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 瑕瓒绾х＄瑙
2025-11-15 17:23:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 瑕瓒绾х＄瑙
2025-11-15 17:27:09 - app.services.user_service - ERROR - user_service - create_user - Error creating user: User with this email already exists
2025-11-15 17:27:09 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: User with this email already exists
  + Exception Group Traceback (most recent call last):
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 121, in admin_create_user
    |     user = await user_service.create_user(user_create)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 29, in create_user
    |     raise ValueError("User with this email already exists")
    | ValueError: User with this email already exists
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 121, in admin_create_user
    user = await user_service.create_user(user_create)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 29, in create_user
    raise ValueError("User with this email already exists")
ValueError: User with this email already exists
2025-11-15 17:27:22 - app.services.user_service - ERROR - user_service - create_user - Error creating user: User with this email already exists
2025-11-15 17:27:22 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: User with this email already exists
  + Exception Group Traceback (most recent call last):
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 192, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    |     raise app_exc from app_exc.__cause__ or app_exc.__context__
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    |     await self.simple_response(scope, receive, send, request_headers=headers)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 121, in admin_create_user
    |     user = await user_service.create_user(user_create)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 29, in create_user
    |     raise ValueError("User with this email already exists")
    | ValueError: User with this email already exists
    +------------------------------------

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 125, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 391, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 290, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\users.py", line 121, in admin_create_user
    user = await user_service.create_user(user_create)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 29, in create_user
    raise ValueError("User with this email already exists")
ValueError: User with this email already exists
2025-11-15 17:34:06 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-15 17:34:06 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-15 17:34:06 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 57, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-15 17:34:07 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-15 17:34:07 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-15 17:34:07 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 57, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-15 17:44:08 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-15 17:44:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-15 17:44:25 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-15 17:44:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-15 17:44:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: User not found
2025-11-15 20:01:14 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-15 20:01:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-15 20:01:14 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-15 20:01:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-16 12:26:10 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-16 12:26:10 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-16 12:26:10 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-16 12:26:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-16 12:32:52 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-16 12:32:52 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-16 12:32:52 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 615, in solve_dependencies
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 57, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-16 12:40:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 瑕瓒绾х＄瑙
2025-11-16 13:41:25 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-16 13:41:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-16 13:41:25 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-16 13:41:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 11:25:06 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 1 validation error for ResumeEvaluationResponse
work_years
  Input should be a valid string [type=string_type, input_value=4.0, input_type=float]
    For further information visit https://errors.pydantic.dev/2.7/v/string_type
2025-11-19 11:25:07 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-11-19 11:25:17 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 1 validation error for ResumeEvaluationResponse
work_years
  Input should be a valid string [type=string_type, input_value=4.0, input_type=float]
    For further information visit https://errors.pydantic.dev/2.7/v/string_type
2025-11-19 11:25:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-11-19 11:26:06 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _save_evaluation_result - 淇瀛璇浠风澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column "work_years" is of type double precision but expression is of type character varying
HINT:  You will need to rewrite or cast the expression.
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('娴璇宸ョ甯_挎 5-7K缇 1骞翠互 (1).pdf', None, 'pdf', 199267, '濮 锛缇\n姘 锛姹\n 璇锛15073368518\n姹锛纭浠跺伐绋甯虹骞存锛2003.08\n浣 锛挎宀抽\n 绠憋3126901316@qq.com\n2021骞9-2025骞6 婀绗涓甯瀛 靛淇℃宸ョ-绉\n涓涓缁╋9/48\n涓讳慨璇剧锛妯℃靛 ... (916 characters truncated) ... 49e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n053c4f51b4da349e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n053c4f51b4da349e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n', '缇', '杩缁村伐绋甯', 20, '', '绾0.3骞', '绉', '婀绗涓甯瀛', 20.0, '[{"name": "\\u5b66\\u5386", "score": 20.0, "max": 20.0, "reason": "\\u672c\\u79d1\\u5b66\\u5386\\uff0c\\u5c97\\u4f4d\\u6559\\u80b2\\u8981\\u6c42\\u4e ... (1024 characters truncated) ... u6280\\u80fd\\u3001\\u9879\\u76ee\\u7ecf\\u9a8c\\u5747\\u4e0d\\u5339\\u914d\\uff0c\\u7efc\\u5408\\u7d20\\u8d28\\u7ef4\\u5ea6\\u7ed9\\u4e880\\u5206"}]', 'PENDING', UUID('ed6a84e7-2e5e-43f5-a80d-372358070a70'), None, None, '"{\'event\': \'message\', \'task_id\': \'7bf3301d-e1fb-4fba-b4a6-fe448664250c\', \'id\': \'e488d878-c125-4e63-b781-819a4490670a\', \'message_id\': \' ... (2722 characters truncated) ... rice\': \'0\', \'total_tokens\': 2002, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 10.363932371139526}}, \'created_at\': 1763522756}"', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('40e8e506-dce5-45f3-bef7-abaee06fa44f'), datetime.datetime(2025, 11, 19, 3, 26, 6, 297240), datetime.datetime(2025, 11, 19, 3, 26, 6, 297240), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 11:26:06 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column "work_years" is of type double precision but expression is of type character varying
HINT:  You will need to rewrite or cast the expression.
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('娴璇宸ョ甯_挎 5-7K缇 1骞翠互 (1).pdf', None, 'pdf', 199267, '濮 锛缇\n姘 锛姹\n 璇锛15073368518\n姹锛纭浠跺伐绋甯虹骞存锛2003.08\n浣 锛挎宀抽\n 绠憋3126901316@qq.com\n2021骞9-2025骞6 婀绗涓甯瀛 靛淇℃宸ョ-绉\n涓涓缁╋9/48\n涓讳慨璇剧锛妯℃靛 ... (916 characters truncated) ... 49e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n053c4f51b4da349e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n053c4f51b4da349e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n', '缇', '杩缁村伐绋甯', 20, '', '绾0.3骞', '绉', '婀绗涓甯瀛', 20.0, '[{"name": "\\u5b66\\u5386", "score": 20.0, "max": 20.0, "reason": "\\u672c\\u79d1\\u5b66\\u5386\\uff0c\\u5c97\\u4f4d\\u6559\\u80b2\\u8981\\u6c42\\u4e ... (1024 characters truncated) ... u6280\\u80fd\\u3001\\u9879\\u76ee\\u7ecf\\u9a8c\\u5747\\u4e0d\\u5339\\u914d\\uff0c\\u7efc\\u5408\\u7d20\\u8d28\\u7ef4\\u5ea6\\u7ed9\\u4e880\\u5206"}]', 'PENDING', UUID('ed6a84e7-2e5e-43f5-a80d-372358070a70'), None, None, '"{\'event\': \'message\', \'task_id\': \'7bf3301d-e1fb-4fba-b4a6-fe448664250c\', \'id\': \'e488d878-c125-4e63-b781-819a4490670a\', \'message_id\': \' ... (2722 characters truncated) ... rice\': \'0\', \'total_tokens\': 2002, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 10.363932371139526}}, \'created_at\': 1763522756}"', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('40e8e506-dce5-45f3-bef7-abaee06fa44f'), datetime.datetime(2025, 11, 19, 3, 26, 6, 297240), datetime.datetime(2025, 11, 19, 3, 26, 6, 297240), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 11:26:06 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column "work_years" is of type double precision but expression is of type character varying
HINT:  You will need to rewrite or cast the expression.
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('娴璇宸ョ甯_挎 5-7K缇 1骞翠互 (1).pdf', None, 'pdf', 199267, '濮 锛缇\n姘 锛姹\n 璇锛15073368518\n姹锛纭浠跺伐绋甯虹骞存锛2003.08\n浣 锛挎宀抽\n 绠憋3126901316@qq.com\n2021骞9-2025骞6 婀绗涓甯瀛 靛淇℃宸ョ-绉\n涓涓缁╋9/48\n涓讳慨璇剧锛妯℃靛 ... (916 characters truncated) ... 49e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n053c4f51b4da349e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n053c4f51b4da349e1XV409i4F1BTwIW3Wf-cWOGknffWMBBl3A~~\n', '缇', '杩缁村伐绋甯', 20, '', '绾0.3骞', '绉', '婀绗涓甯瀛', 20.0, '[{"name": "\\u5b66\\u5386", "score": 20.0, "max": 20.0, "reason": "\\u672c\\u79d1\\u5b66\\u5386\\uff0c\\u5c97\\u4f4d\\u6559\\u80b2\\u8981\\u6c42\\u4e ... (1024 characters truncated) ... u6280\\u80fd\\u3001\\u9879\\u76ee\\u7ecf\\u9a8c\\u5747\\u4e0d\\u5339\\u914d\\uff0c\\u7efc\\u5408\\u7d20\\u8d28\\u7ef4\\u5ea6\\u7ed9\\u4e880\\u5206"}]', 'PENDING', UUID('ed6a84e7-2e5e-43f5-a80d-372358070a70'), None, None, '"{\'event\': \'message\', \'task_id\': \'7bf3301d-e1fb-4fba-b4a6-fe448664250c\', \'id\': \'e488d878-c125-4e63-b781-819a4490670a\', \'message_id\': \' ... (2722 characters truncated) ... rice\': \'0\', \'total_tokens\': 2002, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 10.363932371139526}}, \'created_at\': 1763522756}"', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('40e8e506-dce5-45f3-bef7-abaee06fa44f'), datetime.datetime(2025, 11, 19, 3, 26, 6, 297240), datetime.datetime(2025, 11, 19, 3, 26, 6, 297240), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 11:26:06 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-11-19 11:40:30 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - get_evaluation_history - 峰璇浠峰插け璐: 1 validation error for ResumeEvaluationResponse
work_years
  Input should be a valid string [type=string_type, input_value=4.0, input_type=float]
    For further information visit https://errors.pydantic.dev/2.7/v/string_type
2025-11-19 11:40:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇浠峰插け璐
2025-11-19 11:43:21 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _save_evaluation_result - 淇瀛璇浠风澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column "work_years" is of type double precision but expression is of type character varying
HINT:  You will need to rewrite or cast the expression.
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('娴璇宸ョ甯_挎 7-10K寰寰 5骞.pdf', None, 'pdf', 250373, '寰寰\n | 28宀\n  1603381955@qq.com\n5骞村伐浣缁楠 | 杞浠舵璇 | 璧锛7-8K | 甯锛挎\n涓浜轰\n1. 峰鸿茬藉锛藉ㄩ寮哄害宸ヤ澧涓淇绋冲琛ㄧ般\n2. 灞板烘寮虹搴у瀛涔藉锛借℃版藉苟搴ㄤ瀹宸ヤ涓\n ... (5063 characters truncated) ... 82cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~b533ba50ce582cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~\nb533ba50ce582cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~\n', '寰寰', '纭浠舵璇宸ョ甯', 28, '', '5骞', '澶т', '浜甯板浣甯瀛', 25.0, '[{"name": "\\u5b66\\u5386", "score": 0.0, "max": 20.0, "reason": "\\u7b80\\u5386\\u663e\\u793a\\u4e3a\\u5927\\u4e13\\u5b66\\u5386\\uff0c\\u4e0d\\u7b2 ... (943 characters truncated) ... ": 10.0, "reason": "\\u7efc\\u5408\\u7d20\\u8d28\\u8f83\\u96be\\u4ece\\u7b80\\u5386\\u5ba2\\u89c2\\u5224\\u65ad\\uff0c\\u6682\\u4e0d\\u6253\\u5206"}]', 'PENDING', UUID('819565d7-dd02-43b5-886e-492639b50724'), None, None, '"{\'event\': \'message\', \'task_id\': \'843b67fc-c9bf-4189-aec3-1cf20946d796\', \'id\': \'70a993e4-ed6c-4e8a-aa57-a7c8cffba8d8\', \'message_id\': \' ... (2645 characters truncated) ... price\': \'0\', \'total_tokens\': 4592, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 6.798900991678238}}, \'created_at\': 1763523795}"', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('2ae031d9-4db3-4f27-a18d-daca2978e621'), datetime.datetime(2025, 11, 19, 3, 43, 21, 391129), datetime.datetime(2025, 11, 19, 3, 43, 21, 391129), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 11:43:21 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column "work_years" is of type double precision but expression is of type character varying
HINT:  You will need to rewrite or cast the expression.
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('娴璇宸ョ甯_挎 7-10K寰寰 5骞.pdf', None, 'pdf', 250373, '寰寰\n | 28宀\n  1603381955@qq.com\n5骞村伐浣缁楠 | 杞浠舵璇 | 璧锛7-8K | 甯锛挎\n涓浜轰\n1. 峰鸿茬藉锛藉ㄩ寮哄害宸ヤ澧涓淇绋冲琛ㄧ般\n2. 灞板烘寮虹搴у瀛涔藉锛借℃版藉苟搴ㄤ瀹宸ヤ涓\n ... (5063 characters truncated) ... 82cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~b533ba50ce582cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~\nb533ba50ce582cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~\n', '寰寰', '纭浠舵璇宸ョ甯', 28, '', '5骞', '澶т', '浜甯板浣甯瀛', 25.0, '[{"name": "\\u5b66\\u5386", "score": 0.0, "max": 20.0, "reason": "\\u7b80\\u5386\\u663e\\u793a\\u4e3a\\u5927\\u4e13\\u5b66\\u5386\\uff0c\\u4e0d\\u7b2 ... (943 characters truncated) ... ": 10.0, "reason": "\\u7efc\\u5408\\u7d20\\u8d28\\u8f83\\u96be\\u4ece\\u7b80\\u5386\\u5ba2\\u89c2\\u5224\\u65ad\\uff0c\\u6682\\u4e0d\\u6253\\u5206"}]', 'PENDING', UUID('819565d7-dd02-43b5-886e-492639b50724'), None, None, '"{\'event\': \'message\', \'task_id\': \'843b67fc-c9bf-4189-aec3-1cf20946d796\', \'id\': \'70a993e4-ed6c-4e8a-aa57-a7c8cffba8d8\', \'message_id\': \' ... (2645 characters truncated) ... price\': \'0\', \'total_tokens\': 4592, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 6.798900991678238}}, \'created_at\': 1763523795}"', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('2ae031d9-4db3-4f27-a18d-daca2978e621'), datetime.datetime(2025, 11, 19, 3, 43, 21, 391129), datetime.datetime(2025, 11, 19, 3, 43, 21, 391129), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 11:43:21 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.DatatypeMismatchError'>: column "work_years" is of type double precision but expression is of type character varying
HINT:  You will need to rewrite or cast the expression.
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('娴璇宸ョ甯_挎 7-10K寰寰 5骞.pdf', None, 'pdf', 250373, '寰寰\n | 28宀\n  1603381955@qq.com\n5骞村伐浣缁楠 | 杞浠舵璇 | 璧锛7-8K | 甯锛挎\n涓浜轰\n1. 峰鸿茬藉锛藉ㄩ寮哄害宸ヤ澧涓淇绋冲琛ㄧ般\n2. 灞板烘寮虹搴у瀛涔藉锛借℃版藉苟搴ㄤ瀹宸ヤ涓\n ... (5063 characters truncated) ... 82cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~b533ba50ce582cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~\nb533ba50ce582cd81XN729-8E1ZWwoy2UfKWWOGknffWMBBl3A~~\n', '寰寰', '纭浠舵璇宸ョ甯', 28, '', '5骞', '澶т', '浜甯板浣甯瀛', 25.0, '[{"name": "\\u5b66\\u5386", "score": 0.0, "max": 20.0, "reason": "\\u7b80\\u5386\\u663e\\u793a\\u4e3a\\u5927\\u4e13\\u5b66\\u5386\\uff0c\\u4e0d\\u7b2 ... (943 characters truncated) ... ": 10.0, "reason": "\\u7efc\\u5408\\u7d20\\u8d28\\u8f83\\u96be\\u4ece\\u7b80\\u5386\\u5ba2\\u89c2\\u5224\\u65ad\\uff0c\\u6682\\u4e0d\\u6253\\u5206"}]', 'PENDING', UUID('819565d7-dd02-43b5-886e-492639b50724'), None, None, '"{\'event\': \'message\', \'task_id\': \'843b67fc-c9bf-4189-aec3-1cf20946d796\', \'id\': \'70a993e4-ed6c-4e8a-aa57-a7c8cffba8d8\', \'message_id\': \' ... (2645 characters truncated) ... price\': \'0\', \'total_tokens\': 4592, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 6.798900991678238}}, \'created_at\': 1763523795}"', UUID('663c3a32-596c-4fec-955e-6eace86eb281'), UUID('2ae031d9-4db3-4f27-a18d-daca2978e621'), datetime.datetime(2025, 11, 19, 3, 43, 21, 391129), datetime.datetime(2025, 11, 19, 3, 43, 21, 391129), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 11:43:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-11-19 11:55:59 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 11:55:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 11:55:59 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 11:55:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 11:56:01 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 11:56:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 11:56:08 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-11-19 11:56:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 11:56:09 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-11-19 11:56:09 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 11:56:12 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 11:56:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 11:56:22 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 11:56:22 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 11:58:20 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-11-19 12:06:02 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 12:06:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 12:06:13 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-11-19 12:06:13 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 12:31:31 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: 娉浠浠朵腑版瀹
2025-11-19 12:31:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 娉浠浠朵腑版瀹
2025-11-19 14:11:48 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 14:11:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 14:11:49 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 14:11:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 14:13:00 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-11-19 14:13:10 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 1 validation error for AIEvaluationResult
骞撮
  Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value='', input_type=str]
    For further information visit https://errors.pydantic.dev/2.7/v/int_parsing
2025-11-19 14:15:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-11-19 14:15:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-11-19 14:17:07 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-11-19 14:17:20 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 1 validation error for AIEvaluationResult
骞撮
  Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value='', input_type=str]
    For further information visit https://errors.pydantic.dev/2.7/v/int_parsing
2025-11-19 14:17:35 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: 'ScoringCriteria' object has no attribute 'evaluation_model'
2025-11-19 14:29:04 - app.services.user_service - ERROR - user_service - get_user - Error getting user 0c373730-4bac-4d44-8418-e744ce6f46f1: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:29:04 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:29:04 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:29:21 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-11-19 14:29:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 14:30:15 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _get_evaluation_model - 峰璇浠锋ā澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.job_description_id = $1::UUID]
[parameters: (UUID('6c226db6-6a2d-4bad-ace8-a013b695e429'),)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:30:34 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 1 validation error for AIEvaluationResult
骞撮
  Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value='', input_type=str]
    For further information visit https://errors.pydantic.dev/2.7/v/int_parsing
2025-11-19 14:30:34 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _save_evaluation_result - 淇瀛璇浠风澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InFailedSQLTransactionError'>: current transaction is aborted, commands ignored until end of transaction block
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('.docx', None, 'docx', 213057, '2025.03-充                              芥虹                      版娉/AI璁缁甯                                  靛版浼锛 璐璐ｆ浜烘虹靛版鸿借涓娉锛瀹锋褰绫讳 ... (6107 characters truncated) ... 涓烘朵欢绠便浠躲绋跨便宸插剁瀹涔绫婚浠躲绯荤绫诲ㄦヤ涓妯″ 璐ｄ换杩帮 1浜瑙ｃ骞舵娴璇姹广 2规姹规э涓娴璇规璁″缂 3璐璐 APP 涓绠辩芥璇 4璁捐°ц骞剁淮ゆ璇ㄤ 5寸娴璇缁锛惰韪 bug 淇澶杩搴', '', '', None, '', '', '', '', 60.0, '[{"name": "\\u7efc\\u5408\\u8bc4\\u4ef7", "score": 60.0, "max": 100.0, "reason": "AI\\u89e3\\u6790\\u5931\\u8d25\\uff0c\\u7ed9\\u51fa\\u9ed8\\u8ba4\\u8bc4\\u5206"}]', 'PENDING', UUID('6c226db6-6a2d-4bad-ace8-a013b695e429'), None, None, '"{\'event\': \'message\', \'task_id\': \'1bcb21be-d4f3-4e25-b786-642fdc994340\', \'id\': \'e65657f7-ef6d-4146-8fbd-8500ac6e64c6\', \'message_id\': \' ... (2792 characters truncated) ... price\': \'0\', \'total_tokens\': 4470, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 17.34679915010929}}, \'created_at\': 1763533817}"', UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), UUID('7d4464a1-f5d5-4b28-a2b0-9ab5e7ea7d31'), datetime.datetime(2025, 11, 19, 6, 30, 34, 253356), datetime.datetime(2025, 11, 19, 6, 30, 34, 253356), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:30:34 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InFailedSQLTransactionError'>: current transaction is aborted, commands ignored until end of transaction block
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('.docx', None, 'docx', 213057, '2025.03-充                              芥虹                      版娉/AI璁缁甯                                  靛版浼锛 璐璐ｆ浜烘虹靛版鸿借涓娉锛瀹锋褰绫讳 ... (6107 characters truncated) ... 涓烘朵欢绠便浠躲绋跨便宸插剁瀹涔绫婚浠躲绯荤绫诲ㄦヤ涓妯″ 璐ｄ换杩帮 1浜瑙ｃ骞舵娴璇姹广 2规姹规э涓娴璇规璁″缂 3璐璐 APP 涓绠辩芥璇 4璁捐°ц骞剁淮ゆ璇ㄤ 5寸娴璇缁锛惰韪 bug 淇澶杩搴', '', '', None, '', '', '', '', 60.0, '[{"name": "\\u7efc\\u5408\\u8bc4\\u4ef7", "score": 60.0, "max": 100.0, "reason": "AI\\u89e3\\u6790\\u5931\\u8d25\\uff0c\\u7ed9\\u51fa\\u9ed8\\u8ba4\\u8bc4\\u5206"}]', 'PENDING', UUID('6c226db6-6a2d-4bad-ace8-a013b695e429'), None, None, '"{\'event\': \'message\', \'task_id\': \'1bcb21be-d4f3-4e25-b786-642fdc994340\', \'id\': \'e65657f7-ef6d-4146-8fbd-8500ac6e64c6\', \'message_id\': \' ... (2792 characters truncated) ... price\': \'0\', \'total_tokens\': 4470, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 17.34679915010929}}, \'created_at\': 1763533817}"', UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), UUID('7d4464a1-f5d5-4b28-a2b0-9ab5e7ea7d31'), datetime.datetime(2025, 11, 19, 6, 30, 34, 253356), datetime.datetime(2025, 11, 19, 6, 30, 34, 253356), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:30:34 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - evaluate_resume - 绠璇浠峰け璐: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InFailedSQLTransactionError'>: current transaction is aborted, commands ignored until end of transaction block
[SQL: INSERT INTO resume_evaluations (original_filename, file_path, file_type, file_size, resume_content, candidate_name, candidate_position, candidate_age, candidate_gender, work_years, education_level, school, total_score, evaluation_metrics, status, job_description_id, scoring_criteria_id, conversation_id, ai_response, user_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::INTEGER, $9::VARCHAR, $10::VARCHAR, $11::VARCHAR, $12::VARCHAR, $13::FLOAT, $14::JSON, $15::resumestatus, $16::UUID, $17::UUID, $18::VARCHAR, $19::JSON, $20::UUID, $21::UUID, $22::TIMESTAMP WITHOUT TIME ZONE, $23::TIMESTAMP WITHOUT TIME ZONE, $24::BOOLEAN, $25::UUID, $26::UUID)]
[parameters: ('.docx', None, 'docx', 213057, '2025.03-充                              芥虹                      版娉/AI璁缁甯                                  靛版浼锛 璐璐ｆ浜烘虹靛版鸿借涓娉锛瀹锋褰绫讳 ... (6107 characters truncated) ... 涓烘朵欢绠便浠躲绋跨便宸插剁瀹涔绫婚浠躲绯荤绫诲ㄦヤ涓妯″ 璐ｄ换杩帮 1浜瑙ｃ骞舵娴璇姹广 2规姹规э涓娴璇规璁″缂 3璐璐 APP 涓绠辩芥璇 4璁捐°ц骞剁淮ゆ璇ㄤ 5寸娴璇缁锛惰韪 bug 淇澶杩搴', '', '', None, '', '', '', '', 60.0, '[{"name": "\\u7efc\\u5408\\u8bc4\\u4ef7", "score": 60.0, "max": 100.0, "reason": "AI\\u89e3\\u6790\\u5931\\u8d25\\uff0c\\u7ed9\\u51fa\\u9ed8\\u8ba4\\u8bc4\\u5206"}]', 'PENDING', UUID('6c226db6-6a2d-4bad-ace8-a013b695e429'), None, None, '"{\'event\': \'message\', \'task_id\': \'1bcb21be-d4f3-4e25-b786-642fdc994340\', \'id\': \'e65657f7-ef6d-4146-8fbd-8500ac6e64c6\', \'message_id\': \' ... (2792 characters truncated) ... price\': \'0\', \'total_tokens\': 4470, \'total_price\': \'0\', \'currency\': \'USD\', \'latency\': 17.34679915010929}}, \'created_at\': 1763533817}"', UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), UUID('7d4464a1-f5d5-4b28-a2b0-9ab5e7ea7d31'), datetime.datetime(2025, 11, 19, 6, 30, 34, 253356), datetime.datetime(2025, 11, 19, 6, 30, 34, 253356), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:30:34 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 绠璇浠锋℃朵
2025-11-19 14:33:08 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), '6c226db6-6a2d-4bad-ace8-a013b695e429', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), '6c226db6-6a2d-4bad-ace8-a013b695e429', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:12 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:14 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'c44faf5d-dd7b-444e-a56b-1fed1eb93fd9', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'c44faf5d-dd7b-444e-a56b-1fed1eb93fd9', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:15 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:16 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), '6c226db6-6a2d-4bad-ace8-a013b695e429', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), '6c226db6-6a2d-4bad-ace8-a013b695e429', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:38 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:33:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:19 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:19 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), '6c226db6-6a2d-4bad-ace8-a013b695e429', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), '6c226db6-6a2d-4bad-ace8-a013b695e429', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:28 - app.core.logging - ERROR - hr_workflows - get_scoring_criteria_list - Error getting scoring criteria list: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column scoring_criteria.evaluation_model does not exist
[SQL: SELECT scoring_criteria.title, scoring_criteria.job_title, scoring_criteria.content, scoring_criteria.criteria_data, scoring_criteria.total_score, scoring_criteria.scoring_dimensions, scoring_criteria.evaluation_model, scoring_criteria.status, scoring_criteria.meta_data, scoring_criteria.conversation_id, scoring_criteria.workflow_type, scoring_criteria.user_id, scoring_criteria.job_description_id, scoring_criteria.id, scoring_criteria.created_at, scoring_criteria.updated_at, scoring_criteria.is_active, scoring_criteria.created_by, scoring_criteria.updated_by 
FROM scoring_criteria 
WHERE scoring_criteria.user_id = $1::UUID AND scoring_criteria.is_active = true AND scoring_criteria.job_description_id = $2::UUID ORDER BY scoring_criteria.updated_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'), 'a59920b5-74f6-4eeb-8bdb-60731ec23970', 10, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-11-19 14:39:35 - app.services.user_service - ERROR - user_service - get_user - Error getting user 0c373730-4bac-4d44-8418-e744ce6f46f1: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:39:35 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:39:35 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 14:40:56 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 缂哄evaluation_metrics瀛娈
2025-11-19 14:43:16 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 缂哄evaluation_metrics瀛娈
2025-11-19 14:49:37 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 缂哄evaluation_metrics瀛娈
2025-11-19 14:52:26 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 缂哄total_score瀛娈
2025-11-19 15:07:44 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 15:07:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 15:07:44 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 15:07:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 15:08:09 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin3: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin3',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:08:09 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin3',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:08:09 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 15:08:09 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 15:09:27 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 缂哄total_score瀛娈
2025-11-19 15:15:15 - app.services.user_service - ERROR - user_service - get_user - Error getting user 0c373730-4bac-4d44-8418-e744ce6f46f1: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:15:15 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:15:15 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\futures.py", line 289, in __await__
    yield self  # This tells Task to wait for completion.
    ^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\tasks.py", line 385, in __wakeup
    future.result()
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\futures.py", line 202, in result
    raise self._exception.with_traceback(self._exception_tb)
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:16:51 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 1 validation error for AIEvaluationResult
骞撮
  Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value='', input_type=str]
    For further information visit https://errors.pydantic.dev/2.7/v/int_parsing
2025-11-19 15:23:13 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - _parse_ai_response - 瑙ｆAI搴澶辫触: 1 validation error for AIEvaluationResult
骞撮
  Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value='', input_type=str]
    For further information visit https://errors.pydantic.dev/2.7/v/int_parsing
2025-11-19 15:28:51 - app.api.v1.resume_evaluation - ERROR - resume_evaluation - delete_evaluation - よ浠疯板澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column "resume_evaluation_id" of relation "interview_plans" violates not-null constraint
DETAIL:  Failing row contains (缇, 纭浠剁宸ョ甯, # 纭浠剁宸ョ甯宀浣㈣规

## 涓㈣..., null, 0c373730-4bac-4d44-8418-e744ce6f46f1, 2f44660e-2956-44bd-be1f-cea683a7fcf4, 2025-11-19 03:59:40.527411, 2025-11-19 07:28:51.333689, t, null, null).
[SQL: UPDATE interview_plans SET resume_evaluation_id=$1::UUID, updated_at=$2::TIMESTAMP WITHOUT TIME ZONE WHERE interview_plans.id = $3::UUID]
[parameters: (None, datetime.datetime(2025, 11, 19, 7, 28, 51, 333689), UUID('2f44660e-2956-44bd-be1f-cea683a7fcf4'))]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-11-19 15:28:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: よ浠疯板澶辫触
2025-11-19 15:38:58 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 15:38:58 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 15:38:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 15:38:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 15:39:02 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 15:39:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 15:39:05 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Not enough segments
2025-11-19 15:39:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 15:41:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇浠疯板涓瀛
2025-11-19 15:50:09 - app.services.user_service - ERROR - user_service - get_user - Error getting user 0c373730-4bac-4d44-8418-e744ce6f46f1: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:50:09 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:50:09 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\futures.py", line 289, in __await__
    yield self  # This tells Task to wait for completion.
    ^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\tasks.py", line 385, in __wakeup
    future.result()
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\futures.py", line 202, in result
    raise self._exception.with_traceback(self._exception_tb)
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:50:09 - app.services.user_service - ERROR - user_service - get_user - Error getting user 0c373730-4bac-4d44-8418-e744ce6f46f1: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:50:09 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 15:50:09 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\futures.py", line 289, in __await__
    yield self  # This tells Task to wait for completion.
    ^^^^^^^^^^
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\tasks.py", line 385, in __wakeup
    future.result()
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\futures.py", line 202, in result
    raise self._exception.with_traceback(self._exception_tb)
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 16:15:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 16:15:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 16:15:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 16:15:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 16:45:00 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin3: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin3',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 16:45:00 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin3',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 16:45:00 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 16:45:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 17:15:48 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 17:15:48 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 17:15:49 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 17:15:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 17:16:15 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin3: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin3',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 17:16:15 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin3',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 17:16:15 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 401: Incorrect username or password
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException: 401: Incorrect username or password
2025-11-19 17:16:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-11-19 17:40:21 - app.services.user_service - ERROR - user_service - get_user - Error getting user 0c373730-4bac-4d44-8418-e744ce6f46f1: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 17:40:21 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 17:40:21 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python312\Lib\asyncio\selector_events.py", line 1013, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 848, in _start_transaction
    await self._transaction.start()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 111, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\routing.py", line 381, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 644, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 850, in _start_transaction
    self._handle_exception(error)
  File "E:\workspace-py\hr-agent\backend\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('0c373730-4bac-4d44-8418-e744ce6f46f1'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-11-19 17:52:15 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 17:52:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 17:52:15 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 17:52:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 17:52:15 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 17:52:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 17:52:15 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-11-19 17:52:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-11-19 17:52:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-11-19 17:52:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
