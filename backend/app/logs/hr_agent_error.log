2025-10-02 11:21:23 - app.core.database - ERROR - database - init_db - Error initializing database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:21:23 - main - ERROR - main - lifespan - Failed to initialize database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:21:56 - app.core.database - ERROR - database - init_db - Error initializing database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:21:56 - main - ERROR - main - lifespan - Failed to initialize database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:22:31 - app.core.database - ERROR - database - init_db - Error initializing database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:22:31 - main - ERROR - main - lifespan - Failed to initialize database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:28:01 - app.core.database - ERROR - database - init_db - Error initializing database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 11:28:01 - main - ERROR - main - lifespan - Failed to initialize database: [WinError 1225] 远程计算机拒绝网络连接。
2025-10-02 12:00:36 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 12:02:35 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-02 12:03:05 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'authenticate'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 60, in login
    user = await user_service.authenticate(form_data.username, form_data.password)
AttributeError: 'UserService' object has no attribute 'authenticate'
2025-10-02 12:04:28 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'authenticate'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 60, in login
    user = await user_service.authenticate(form_data.username, form_data.password)
AttributeError: 'UserService' object has no attribute 'authenticate'
2025-10-02 12:05:33 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'authenticate'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 60, in login
    user = await user_service.authenticate(form_data.username, form_data.password)
AttributeError: 'UserService' object has no attribute 'authenticate'
2025-10-02 12:06:44 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'authenticate'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 60, in login
    user = await user_service.authenticate(form_data.username, form_data.password)
AttributeError: 'UserService' object has no attribute 'authenticate'
2025-10-02 12:08:04 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'authenticate'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 60, in login
    user = await user_service.authenticate(form_data.username, form_data.password)
AttributeError: 'UserService' object has no attribute 'authenticate'
2025-10-02 12:08:38 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'authenticate'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 60, in login
    user = await user_service.authenticate(form_data.username, form_data.password)
AttributeError: 'UserService' object has no attribute 'authenticate'
2025-10-02 12:10:17 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-02 12:10:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-02 12:10:19 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-02 12:10:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-02 15:22:55 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-02 15:22:55 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-02 15:22:55 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-02 15:22:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-02 15:22:57 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-02 15:22:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-02 15:23:41 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'UserService' object has no attribute 'get_by_id'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 43, in get_current_user
    user = await user_service.get_by_id(user_id)
AttributeError: 'UserService' object has no attribute 'get_by_id'
2025-10-02 15:23:43 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-02 15:23:45 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-02 15:25:13 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-02 15:25:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-02 15:26:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-02 15:26:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-02 15:35:21 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-02 15:35:21 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-02 15:35:21 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-02 15:35:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-02 15:35:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-02 15:35:25 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-02 17:51:39 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-02 17:51:39 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-02 20:59:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-02 20:59:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 09:20:24 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 09:20:24 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 09:20:24 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 09:20:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 10:22:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 10:22:21 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 10:22:21 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 10:22:21 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 10:22:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 10:33:33 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 10:33:33 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 10:33:33 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 10:33:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 10:50:40 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 10:50:40 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:01:13 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:01:13 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:08:54 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:08:54 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:08:56 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:08:56 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:08:56 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 11:08:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 11:17:14 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:17:14 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:17:16 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:17:16 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:32:39 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:32:39 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:32:44 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:32:44 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:32:44 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 11:32:44 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 11:32:51 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:32:51 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:43:09 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:43:09 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:43:20 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:43:20 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:43:20 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 11:43:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 11:48:56 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:48:56 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:48:58 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:48:58 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:48:58 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 11:48:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 11:58:49 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:58:49 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:58:50 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:58:50 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:58:50 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 11:58:50 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 11:59:02 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 11:59:02 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:08:59 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:08:59 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:09:00 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:09:00 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:09:00 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 12:09:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 12:14:51 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:14:51 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:15:07 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:15:07 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:19:26 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:19:26 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:19:27 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:19:27 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:19:27 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 12:19:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 12:31:52 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:31:52 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:31:52 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 12:31:52 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:37:00 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:37:00 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:37:00 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 13:37:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 13:38:56 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 13:53:40 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:53:40 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:53:42 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:53:42 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 13:53:42 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 13:53:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 16:30:49 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 16:30:49 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 16:30:49 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 16:30:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 17:02:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 17:04:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 17:43:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 17:43:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 17:43:33 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 17:43:33 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 17:43:33 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 17:43:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 17:46:52 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 1 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 17:47:45 - app.services.knowledge_base_service - ERROR - knowledge_base_service - create_knowledge_base - Error creating knowledge base: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "knowledge_bases_name_key"
DETAIL:  Key (name)=(11) already exists.
[SQL: INSERT INTO knowledge_bases (name, description, is_public, is_searchable, meta_data, document_count, category, tags, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::BOOLEAN, $4::BOOLEAN, $5::JSON, $6::INTEGER, $7::VARCHAR, $8::JSON, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('11', '11', True, True, '{}', 0, None, '[]', UUID('e77252bf-9ebe-4d05-8fec-2a29224ed3a6'), datetime.datetime(2025, 10, 3, 9, 47, 45, 668113), datetime.datetime(2025, 10, 3, 9, 47, 45, 668113), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 17:47:45 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "knowledge_bases_name_key"
DETAIL:  Key (name)=(11) already exists.
[SQL: INSERT INTO knowledge_bases (name, description, is_public, is_searchable, meta_data, document_count, category, tags, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::BOOLEAN, $4::BOOLEAN, $5::JSON, $6::INTEGER, $7::VARCHAR, $8::JSON, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('11', '11', True, True, '{}', 0, None, '[]', UUID('e77252bf-9ebe-4d05-8fec-2a29224ed3a6'), datetime.datetime(2025, 10, 3, 9, 47, 45, 668113), datetime.datetime(2025, 10, 3, 9, 47, 45, 668113), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 557, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
  File "asyncpg\protocol\protocol.pyx", line 207, in bind_execute
asyncpg.exceptions.UniqueViolationError: duplicate key value violates unique constraint "knowledge_bases_name_key"
DETAIL:  Key (name)=(11) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 569, in _prepare_and_execute
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "knowledge_bases_name_key"
DETAIL:  Key (name)=(11) already exists.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_base.py", line 46, in create_knowledge_base
    knowledge_base = await kb_service.create(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 111, in create
    return await self.create_knowledge_base(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 40, in create_knowledge_base
    await self.db.commit()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 1969, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 1256, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 1231, in _prepare_impl
    self.session.flush()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 4312, in flush
    self._flush(objects)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 4447, in _flush
    with util.safe_reraise():
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 4408, in _flush
    flush_context.execute()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 569, in _prepare_and_execute
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 520, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "knowledge_bases_name_key"
DETAIL:  Key (name)=(11) already exists.
[SQL: INSERT INTO knowledge_bases (name, description, is_public, is_searchable, meta_data, document_count, category, tags, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::VARCHAR, $3::BOOLEAN, $4::BOOLEAN, $5::JSON, $6::INTEGER, $7::VARCHAR, $8::JSON, $9::UUID, $10::TIMESTAMP WITHOUT TIME ZONE, $11::TIMESTAMP WITHOUT TIME ZONE, $12::BOOLEAN, $13::UUID, $14::UUID)]
[parameters: ('11', '11', True, True, '{}', 0, None, '[]', UUID('e77252bf-9ebe-4d05-8fec-2a29224ed3a6'), datetime.datetime(2025, 10, 3, 9, 47, 45, 668113), datetime.datetime(2025, 10, 3, 9, 47, 45, 668113), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-10-03 17:48:06 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 1 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 17:50:33 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 2 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:29:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 18:29:22 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:29:22 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:29:22 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 18:29:22 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 18:29:31 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:29:31 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:29:31 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-03 18:29:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-03 18:29:42 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 2 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:30:10 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 1 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'dict_type', 'loc': ('response', 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:32:57 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-03 18:33:02 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:33:57 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:34:10 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:35:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 18:37:04 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:37:22 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:40:04 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:41:33 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:43:35 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:46:22 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:47:41 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:47:52 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:48:26 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:49:07 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-03 18:50:21 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:50:55 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:51:21 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:52:16 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:54:15 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 292, in app
    content = await serialize_response(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'dict_type', 'loc': ('response', 0, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 1, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}
  {'type': 'dict_type', 'loc': ('response', 2, 'metadata'), 'msg': 'Input should be a valid dictionary', 'input': MetaData(), 'url': 'https://errors.pydantic.dev/2.11/v/dict_type'}

2025-10-03 18:56:17 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:57:45 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:58:56 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:58:56 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:59:00 - app.services.user_service - ERROR - user_service - get_user - Error getting user e5b1dc69-0e61-4d8d-8e51-fd662291e8f2: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:59:00 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 远程主机强迫关闭了一个现有的连接。

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('e5b1dc69-0e61-4d8d-8e51-fd662291e8f2'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-03 18:59:24 - app.services.knowledge_base_service - ERROR - knowledge_base_service - create_knowledge_base - Error creating knowledge base: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 18:59:24 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: 'KnowledgeBaseCreate' object has no attribute 'metadata'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_base.py", line 46, in create_knowledge_base
    knowledge_base = await kb_service.create(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 111, in create
    return await self.create_knowledge_base(kb_data)
  File "E:\workspace-py\hr-agent\backend\app\services\knowledge_base_service.py", line 36, in create_knowledge_base
    meta_data=kb_data.metadata or {}
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\pydantic\main.py", line 991, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'KnowledgeBaseCreate' object has no attribute 'metadata'
2025-10-03 18:59:39 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:59:40 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-03 18:59:41 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-04 09:40:01 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: Error code: 400 - {'error': {'code': '1210', 'message': 'API 璋ㄥ版璇锛璇锋ユ妗ｃRequest Entity Too Large'}}
2025-10-04 09:40:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: Error code: 400 - {'error': {'code': '1210', 'message': 'API 璋ㄥ版璇锛璇锋ユ妗ｃRequest Entity Too Large'}}
2025-10-04 09:52:29 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 09:52:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 09:52:52 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 09:52:52 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 09:52:52 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-04 09:52:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-04 10:04:49 - app.services.user_service - ERROR - user_service - get_user - Error getting user d75fcecf-253b-4450-b626-7a3e8490d0da: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:04:49 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:04:49 - app.services.user_service - ERROR - user_service - get_user - Error getting user d75fcecf-253b-4450-b626-7a3e8490d0da: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:04:49 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:04:49 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:04:49 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:09:22 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-04 10:09:31 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-04 10:09:42 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-04 10:10:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-04 10:10:42 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-04 10:10:50 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-04 10:10:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-04 10:10:51 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-04 10:12:23 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-04 10:35:37 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: type object 'ValidationError' has no attribute 'send'
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 48, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
  File "E:\workspace-py\hr-agent\backend\app\core\middleware.py", line 25, in dispatch
    response = await call_next(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\knowledge_assistant.py", line 130, in ask_knowledge_assistant
    result = await rag_service.ask_question(
AttributeError: type object 'ValidationError' has no attribute 'send'
2025-10-04 10:36:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error generating answer: 1 validation error for ChatOpenAI
__root__
  Did not find openai_api_key, please add an environment variable `OPENAI_API_KEY` which contains it, or pass `openai_api_key` as a named parameter. (type=value_error)
2025-10-04 10:40:57 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 10:40:57 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 10:50:09 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error creating document chunks: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIME ... 551 characters truncated ... ::TIMESTAMP WITHOUT TIME ZONE, $45::TIMESTAMP WITHOUT TIME ZONE, $46::BOOLEAN, $47::UUID, $48::UUID)]
[parameters: ('锛1锛婀姘存′\n锛2006骞930ユ绗灞浜烘浠ｈ〃澶т甯稿″\n浼绗浜涓娆′璁杩规2021骞331ユ\n绗涓灞浜烘浠ｈ〃澶т甯稿″浼绗浜涓娆′璁\n充淇广婀寤虹甯虹＄′绛涓浠跺版\nф瑙冲淇姝 2025骞731ユ绗\n灞浜烘 ... (715 characters truncated) ... 瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋夸富绠￠ㄩㄥ妗\n绗＄浜烘垮舵抽ㄩㄥ褰寮烘按虹璁炬', 0, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('a38283b6-3eae-496f-8861-00c955673691'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '浜烘垮瑰瀹斤骞舵ュ藉￠㈡按琛夸富绠￠ㄩㄥ妗姘存浜\n涓灞瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋 ... (715 characters truncated) ... 瑕姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存瑙瑙绋锛浣跨ㄧ藉惰瀹涓ㄦ瑁\n澶渚娉缁妫瀹肩璁￠ㄥ凤淇璇娴版瀹㈣瀹涓寰', 1, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('10708f4e-c1b1-404d-9b39-0ed234dfe112'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟\n哄锋瑙\n宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存 ... (719 characters truncated) ... 姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧搴褰\n瀹淬涓淬浠浜姘磋婧璁鸿宸ョ璁捐′互绉瀛绌剁', 2, 979, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('72c0135d-16ba-44fe-a951-639d8b3f33ef'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '浜よ虫淳椹昏惧虹甯娌诲姘存烘锛骞剁卞跺姘存娴璧\n缁涓姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧 ... (683 characters truncated) ... \n浜ら杩杈娴蜂搴ョ＄ㄩㄥ褰┿\n锛7锛姘存娴涓ㄨ溅杈瑰搴褰璁剧疆缁涓蹇\n绗涔¤′瑙瀹琛涓猴娉寰娉瑙瑙瀹浜娉寰\n璐ｄ换锛浠惰瀹\n藉跺伐浣浜哄ㄦ按宸ヤ涓婊ョㄨ╁拷瀹寰绉寮\n锛渚娉缁浜澶\n绗浜℃′2025骞101ヨ捣借', 3, 943, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('057e4402-2c31-497f-8fe6-523e091f4041'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:50:09 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIME ... 551 characters truncated ... ::TIMESTAMP WITHOUT TIME ZONE, $45::TIMESTAMP WITHOUT TIME ZONE, $46::BOOLEAN, $47::UUID, $48::UUID)]
[parameters: ('锛1锛婀姘存′\n锛2006骞930ユ绗灞浜烘浠ｈ〃澶т甯稿″\n浼绗浜涓娆′璁杩规2021骞331ユ\n绗涓灞浜烘浠ｈ〃澶т甯稿″浼绗浜涓娆′璁\n充淇广婀寤虹甯虹＄′绛涓浠跺版\nф瑙冲淇姝 2025骞731ユ绗\n灞浜烘 ... (715 characters truncated) ... 瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋夸富绠￠ㄩㄥ妗\n绗＄浜烘垮舵抽ㄩㄥ褰寮烘按虹璁炬', 0, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('a38283b6-3eae-496f-8861-00c955673691'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '浜烘垮瑰瀹斤骞舵ュ藉￠㈡按琛夸富绠￠ㄩㄥ妗姘存浜\n涓灞瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋 ... (715 characters truncated) ... 瑕姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存瑙瑙绋锛浣跨ㄧ藉惰瀹涓ㄦ瑁\n澶渚娉缁妫瀹肩璁￠ㄥ凤淇璇娴版瀹㈣瀹涓寰', 1, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('10708f4e-c1b1-404d-9b39-0ed234dfe112'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟\n哄锋瑙\n宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存 ... (719 characters truncated) ... 姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧搴褰\n瀹淬涓淬浠浜姘磋婧璁鸿宸ョ璁捐′互绉瀛绌剁', 2, 979, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('72c0135d-16ba-44fe-a951-639d8b3f33ef'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '浜よ虫淳椹昏惧虹甯娌诲姘存烘锛骞剁卞跺姘存娴璧\n缁涓姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧 ... (683 characters truncated) ... \n浜ら杩杈娴蜂搴ョ＄ㄩㄥ褰┿\n锛7锛姘存娴涓ㄨ溅杈瑰搴褰璁剧疆缁涓蹇\n绗涔¤′瑙瀹琛涓猴娉寰娉瑙瑙瀹浜娉寰\n璐ｄ换锛浠惰瀹\n藉跺伐浣浜哄ㄦ按宸ヤ涓婊ョㄨ╁拷瀹寰绉寮\n锛渚娉缁浜澶\n绗浜℃′2025骞101ヨ捣借', 3, 943, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('057e4402-2c31-497f-8fe6-523e091f4041'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:50:09 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIME ... 551 characters truncated ... ::TIMESTAMP WITHOUT TIME ZONE, $45::TIMESTAMP WITHOUT TIME ZONE, $46::BOOLEAN, $47::UUID, $48::UUID)]
[parameters: ('锛1锛婀姘存′\n锛2006骞930ユ绗灞浜烘浠ｈ〃澶т甯稿″\n浼绗浜涓娆′璁杩规2021骞331ユ\n绗涓灞浜烘浠ｈ〃澶т甯稿″浼绗浜涓娆′璁\n充淇广婀寤虹甯虹＄′绛涓浠跺版\nф瑙冲淇姝 2025骞731ユ绗\n灞浜烘 ... (715 characters truncated) ... 瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋夸富绠￠ㄩㄥ妗\n绗＄浜烘垮舵抽ㄩㄥ褰寮烘按虹璁炬', 0, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('a38283b6-3eae-496f-8861-00c955673691'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '浜烘垮瑰瀹斤骞舵ュ藉￠㈡按琛夸富绠￠ㄩㄥ妗姘存浜\n涓灞瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋 ... (715 characters truncated) ... 瑕姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存瑙瑙绋锛浣跨ㄧ藉惰瀹涓ㄦ瑁\n澶渚娉缁妫瀹肩璁￠ㄥ凤淇璇娴版瀹㈣瀹涓寰', 1, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('10708f4e-c1b1-404d-9b39-0ed234dfe112'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟\n哄锋瑙\n宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存 ... (719 characters truncated) ... 姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧搴褰\n瀹淬涓淬浠浜姘磋婧璁鸿宸ョ璁捐′互绉瀛绌剁', 2, 979, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('72c0135d-16ba-44fe-a951-639d8b3f33ef'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None, '浜よ虫淳椹昏惧虹甯娌诲姘存烘锛骞剁卞跺姘存娴璧\n缁涓姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧 ... (683 characters truncated) ... \n浜ら杩杈娴蜂搴ョ＄ㄩㄥ褰┿\n锛7锛姘存娴涓ㄨ溅杈瑰搴褰璁剧疆缁涓蹇\n绗涔¤′瑙瀹琛涓猴娉寰娉瑙瑙瀹浜娉寰\n璐ｄ换锛浠惰瀹\n藉跺伐浣浜哄ㄦ按宸ヤ涓婊ョㄨ╁拷瀹寰绉寮\n锛渚娉缁浜澶\n绗浜℃′2025骞101ヨ捣借', 3, 943, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('c9b82e7e-a1ab-489c-a59a-bff25723e938'), UUID('057e4402-2c31-497f-8fe6-523e091f4041'), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), datetime.datetime(2025, 10, 4, 2, 49, 50, 267506), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:57:33 - app.services.enhanced_document_service - ERROR - enhanced_document_service - get_user_documents - Error getting user documents: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.user_id = $1::UUID AND documents.knowledge_base_id = $2::UUID ORDER BY documents.created_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('ce7b50db-5092-4b2f-b1bd-11c87a70aa21'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 10:57:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error retrieving documents: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT documents.filename, documents.original_filename, documents.file_path, documents.file_size, documents.file_hash, documents.mime_type, documents.extracted_content, documents.summary, documents.meta_data, documents.embedding, documents.category, documents.tags, documents.user_id, documents.knowledge_base_id, documents.id, documents.created_at, documents.updated_at, documents.is_active, documents.created_by, documents.updated_by 
FROM documents 
WHERE documents.user_id = $1::UUID AND documents.knowledge_base_id = $2::UUID ORDER BY documents.created_at DESC 
 LIMIT $3::INTEGER OFFSET $4::INTEGER]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'), UUID('ce7b50db-5092-4b2f-b1bd-11c87a70aa21'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 11:56:04 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error creating document chunks: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIME ... 551 characters truncated ... ::TIMESTAMP WITHOUT TIME ZONE, $45::TIMESTAMP WITHOUT TIME ZONE, $46::BOOLEAN, $47::UUID, $48::UUID)]
[parameters: ('锛1锛婀姘存′\n锛2006骞930ユ绗灞浜烘浠ｈ〃澶т甯稿″\n浼绗浜涓娆′璁杩规2021骞331ユ\n绗涓灞浜烘浠ｈ〃澶т甯稿″浼绗浜涓娆′璁\n充淇广婀寤虹甯虹＄′绛涓浠跺版\nф瑙冲淇姝 2025骞731ユ绗\n灞浜烘 ... (715 characters truncated) ... 瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋夸富绠￠ㄩㄥ妗\n绗＄浜烘垮舵抽ㄩㄥ褰寮烘按虹璁炬', 0, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('d0dc34c1-f041-44e9-b16f-18d6ab80ec39'), UUID('e83b74a1-9127-4242-99d1-6090a009ed70'), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), True, None, None, '浜烘垮瑰瀹斤骞舵ュ藉￠㈡按琛夸富绠￠ㄩㄥ妗姘存浜\n涓灞瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋 ... (715 characters truncated) ... 瑕姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存瑙瑙绋锛浣跨ㄧ藉惰瀹涓ㄦ瑁\n澶渚娉缁妫瀹肩璁￠ㄥ凤淇璇娴版瀹㈣瀹涓寰', 1, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('d0dc34c1-f041-44e9-b16f-18d6ab80ec39'), UUID('94edf5ea-ff68-4bb8-9f1c-ca2e5141ded8'), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), True, None, None, '搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟\n哄锋瑙\n宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存 ... (719 characters truncated) ... 姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧搴褰\n瀹淬涓淬浠浜姘磋婧璁鸿宸ョ璁捐′互绉瀛绌剁', 2, 979, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('d0dc34c1-f041-44e9-b16f-18d6ab80ec39'), UUID('78e10dbc-85bf-490f-9f2f-6b34ca3aaca8'), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), True, None, None, '浜よ虫淳椹昏惧虹甯娌诲姘存烘锛骞剁卞跺姘存娴璧\n缁涓姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧 ... (683 characters truncated) ... \n浜ら杩杈娴蜂搴ョ＄ㄩㄥ褰┿\n锛7锛姘存娴涓ㄨ溅杈瑰搴褰璁剧疆缁涓蹇\n绗涔¤′瑙瀹琛涓猴娉寰娉瑙瑙瀹浜娉寰\n璐ｄ换锛浠惰瀹\n藉跺伐浣浜哄ㄦ按宸ヤ涓婊ョㄨ╁拷瀹寰绉寮\n锛渚娉缁浜澶\n绗浜℃′2025骞101ヨ捣借', 3, 943, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('d0dc34c1-f041-44e9-b16f-18d6ab80ec39'), UUID('552962e0-c8bf-4bde-acec-5acd4e53d1f2'), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), datetime.datetime(2025, 10, 4, 3, 55, 45, 182425), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 11:56:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: type object 'TypeError' has no attribute 'unlink'
2025-10-04 12:03:18 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error creating document chunks: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIME ... 551 characters truncated ... ::TIMESTAMP WITHOUT TIME ZONE, $45::TIMESTAMP WITHOUT TIME ZONE, $46::BOOLEAN, $47::UUID, $48::UUID)]
[parameters: ('锛1锛婀姘存′\n锛2006骞930ユ绗灞浜烘浠ｈ〃澶т甯稿″\n浼绗浜涓娆′璁杩规2021骞331ユ\n绗涓灞浜烘浠ｈ〃澶т甯稿″浼绗浜涓娆′璁\n充淇广婀寤虹甯虹＄′绛涓浠跺版\nф瑙冲淇姝 2025骞731ユ绗\n灞浜烘 ... (715 characters truncated) ... 瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋夸富绠￠ㄩㄥ妗\n绗＄浜烘垮舵抽ㄩㄥ褰寮烘按虹璁炬', 0, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('747248e4-b4a6-4920-b751-f0a31fee5c19'), UUID('7decea26-cff8-4e95-bb32-143e7949fc4a'), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), True, None, None, '浜烘垮瑰瀹斤骞舵ュ藉￠㈡按琛夸富绠￠ㄩㄥ妗姘存浜\n涓灞瑙搴褰涓藉绌洪磋姘村╁灞瑙绛歌ャ\n娲鹃┗璁惧虹甯娌诲姘存烘规姘存浜涓灞瑙\n琛垮哄缁娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋 ... (715 characters truncated) ... 瑕姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存瑙瑙绋锛浣跨ㄧ藉惰瀹涓ㄦ瑁\n澶渚娉缁妫瀹肩璁￠ㄥ凤淇璇娴版瀹㈣瀹涓寰', 1, 975, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('747248e4-b4a6-4920-b751-f0a31fee5c19'), UUID('33a33183-d90f-402d-8ee2-c5aeb2e71ead'), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), True, None, None, '搴褰娲鹃┗璁惧虹甯娌诲姘存烘瀹℃ュ苟\n哄锋瑙\n宸插缓ㄥ缓姘村╁伐绋ц姹濂姘存璁炬藉缓璁剧锛辨按\n宸ョ绠＄浣椤圭寤鸿惧浣缁缁缂堕濂姘存璁炬借捐℃浠讹\n灞ヨ姘存娴绔璁剧璋寸搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存 ... (719 characters truncated) ... 姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧搴褰\n瀹淬涓淬浠浜姘磋婧璁鸿宸ョ璁捐′互绉瀛绌剁', 2, 979, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('747248e4-b4a6-4920-b751-f0a31fee5c19'), UUID('eac08c01-c8ba-4717-b7c3-7fa092072855'), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), True, None, None, '浜よ虫淳椹昏惧虹甯娌诲姘存烘锛骞剁卞跺姘存娴璧\n缁涓姹浜よ崇姘存烘姘存烘搴褰濡ュ瀛ㄥ淇绠℃按娴\n璧\n浣跨ㄦ按娴璧浣涓浜哄褰靛宠瀹锛\n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧 ... (683 characters truncated) ... \n浜ら杩杈娴蜂搴ョ＄ㄩㄥ褰┿\n锛7锛姘存娴涓ㄨ溅杈瑰搴褰璁剧疆缁涓蹇\n绗涔¤′瑙瀹琛涓猴娉寰娉瑙瑙瀹浜娉寰\n璐ｄ换锛浠惰瀹\n藉跺伐浣浜哄ㄦ按宸ヤ涓婊ョㄨ╁拷瀹寰绉寮\n锛渚娉缁浜澶\n绗浜℃′2025骞101ヨ捣借', 3, 943, None, '{"filename": "\\u6e56\\u5357\\u7701\\u6c34\\u6587\\u6761\\u4f8b_20250731.pdf", "category": null}', UUID('747248e4-b4a6-4920-b751-f0a31fee5c19'), UUID('e49ba7c0-8205-4c56-97cf-930c95dbc426'), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), datetime.datetime(2025, 10, 4, 4, 2, 59, 85635), True, None, None)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 12:03:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: type object 'TypeError' has no attribute 'unlink'
2025-10-04 12:41:47 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 12:41:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 12:42:09 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 12:42:09 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 12:42:09 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-04 12:42:09 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-04 16:14:20 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 16:14:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 16:14:41 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 16:14:41 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 16:14:41 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-04 16:14:41 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-04 16:29:34 - app.services.user_service - ERROR - user_service - get_user - Error getting user d75fcecf-253b-4450-b626-7a3e8490d0da: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 16:29:34 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 16:29:34 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 16:50:24 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 16:50:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 16:50:27 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 16:50:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 16:50:27 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 16:50:27 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 17:14:35 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error creating document chunks: (builtins.TypeError) Object of type UUID is not JSON serializable
[SQL: INSERT INTO document_chunks (content, chunk_index, chunk_size, embedding, meta_data, document_id, id, created_at, updated_at, is_active, created_by, updated_by) VALUES ($1::VARCHAR, $2::INTEGER, $3::INTEGER, $4, $5::JSON, $6::UUID, $7::UUID, $8::TIMESTAMP WITHOUT TIME ZONE, $9::TIMESTAMP WITHOUT TIME ZONE, $10::BOOLEAN, $11::UUID, $12::UUID)]
[parameters: [{'meta_data': {'filename': '婀姘存′_20250731.pdf', 'category': None, 'knowledge_base_id': UUID('ce7b50db-5092-4b2f-b1bd-11c87a70aa21')}, 'chunk_index' ... (1021 characters truncated) ... 娴绀句灞瑕锛跺琛垮哄姘存浜涓灞\n瑙蜂瀹芥规锛ユ绾т汉姘垮瑰瀹斤骞舵ョ浜烘垮\n姘磋夸富绠￠ㄩㄥ妗\n绗＄浜烘垮舵抽ㄩㄥ褰寮烘按虹璁炬', 'created_by': None, 'embedding': None, 'updated_by': None}, {'meta_data': {'filename': '婀姘存′_20250731.pdf', 'category': None, 'knowledge_base_id': UUID('ce7b50db-5092-4b2f-b1bd-11c87a70aa21')}, 'chunk_index' ... (1021 characters truncated) ... 搴\n绗涓′浜姘存娴娲诲ㄧ浣涓浜哄褰靛藉跺\n姘存瑙瑙绋锛浣跨ㄧ藉惰瀹涓ㄦ瑁\n澶渚娉缁妫瀹肩璁￠ㄥ凤淇璇娴版瀹㈣瀹涓寰', 'created_by': None, 'embedding': None, 'updated_by': None}, {'meta_data': {'filename': '婀姘存′_20250731.pdf', 'category': None, 'knowledge_base_id': UUID('ce7b50db-5092-4b2f-b1bd-11c87a70aa21')}, 'chunk_index' ... (1025 characters truncated) ... n涓寰杞璁┿杞虹ㄤ朵ュ╂椿ㄣ缂堕瑕瑙\n杩琛归」寤鸿惧姘磋婧绠＄绛浣跨ㄧ姘存娴璧搴褰\n瀹淬涓淬浠浜姘磋婧璁鸿宸ョ璁捐′互绉瀛绌剁', 'created_by': None, 'embedding': None, 'updated_by': None}, {'meta_data': {'filename': '婀姘存′_20250731.pdf', 'category': None, 'knowledge_base_id': UUID('ce7b50db-5092-4b2f-b1bd-11c87a70aa21')}, 'chunk_index' ... (989 characters truncated) ... 瀹琛涓猴娉寰娉瑙瑙瀹浜娉寰\n璐ｄ换锛浠惰瀹\n藉跺伐浣浜哄ㄦ按宸ヤ涓婊ョㄨ╁拷瀹寰绉寮\n锛渚娉缁浜澶\n绗浜℃′2025骞101ヨ捣借', 'created_by': None, 'embedding': None, 'updated_by': None}]]
2025-10-04 17:14:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: type object 'TypeError' has no attribute 'unlink'
2025-10-04 17:15:49 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: type object 'TypeError' has no attribute 'unlink'
2025-10-04 17:18:32 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error adding documents to PGVector: (builtins.TypeError) Object of type UUID is not JSON serializable
[SQL: INSERT INTO langchain_pg_embedding (id, collection_id, embedding, document, cmetadata) VALUES (%(id_m0)s, %(collection_id_m0)s::UUID, %(embedding_m0)s, %(document_m0)s, %(cmetadata_m0)s), (%(id_m1)s, %(collection_id_m1)s::UUID, %(embedding_m1)s, %(document_m1)s, %(cmetadata_m1)s), (%(id_m2)s, %(collection_id_m2)s::UUID, %(embedding_m2)s, %(document_m2)s, %(cmetadata_m2)s), (%(id_m3)s, %(collection_id_m3)s::UUID, %(embedding_m3)s, %(document_m3)s, %(cmetadata_m3)s) ON CONFLICT (id) DO UPDATE SET embedding = excluded.embedding, document = excluded.document, cmetadata = excluded.cmetadata]
[parameters: [{}]]
2025-10-04 17:18:32 - app.services.enhanced_document_service - ERROR - enhanced_document_service - _create_document_chunks_with_pgvector - Error creating document chunks: (builtins.TypeError) Object of type UUID is not JSON serializable
[SQL: INSERT INTO langchain_pg_embedding (id, collection_id, embedding, document, cmetadata) VALUES (%(id_m0)s, %(collection_id_m0)s::UUID, %(embedding_m0)s, %(document_m0)s, %(cmetadata_m0)s), (%(id_m1)s, %(collection_id_m1)s::UUID, %(embedding_m1)s, %(document_m1)s, %(cmetadata_m1)s), (%(id_m2)s, %(collection_id_m2)s::UUID, %(embedding_m2)s, %(document_m2)s, %(cmetadata_m2)s), (%(id_m3)s, %(collection_id_m3)s::UUID, %(embedding_m3)s, %(document_m3)s, %(cmetadata_m3)s) ON CONFLICT (id) DO UPDATE SET embedding = excluded.embedding, document = excluded.document, cmetadata = excluded.cmetadata]
[parameters: [{}]]
2025-10-04 17:18:32 - app.services.enhanced_document_service - ERROR - enhanced_document_service - upload_and_process_document - Error uploading document: (builtins.TypeError) Object of type UUID is not JSON serializable
[SQL: INSERT INTO langchain_pg_embedding (id, collection_id, embedding, document, cmetadata) VALUES (%(id_m0)s, %(collection_id_m0)s::UUID, %(embedding_m0)s, %(document_m0)s, %(cmetadata_m0)s), (%(id_m1)s, %(collection_id_m1)s::UUID, %(embedding_m1)s, %(document_m1)s, %(cmetadata_m1)s), (%(id_m2)s, %(collection_id_m2)s::UUID, %(embedding_m2)s, %(document_m2)s, %(cmetadata_m2)s), (%(id_m3)s, %(collection_id_m3)s::UUID, %(embedding_m3)s, %(document_m3)s, %(cmetadata_m3)s) ON CONFLICT (id) DO UPDATE SET embedding = excluded.embedding, document = excluded.document, cmetadata = excluded.cmetadata]
[parameters: [{}]]
2025-10-04 17:18:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Error uploading document: (builtins.TypeError) Object of type UUID is not JSON serializable
[SQL: INSERT INTO langchain_pg_embedding (id, collection_id, embedding, document, cmetadata) VALUES (%(id_m0)s, %(collection_id_m0)s::UUID, %(embedding_m0)s, %(document_m0)s, %(cmetadata_m0)s), (%(id_m1)s, %(collection_id_m1)s::UUID, %(embedding_m1)s, %(document_m1)s, %(cmetadata_m1)s), (%(id_m2)s, %(collection_id_m2)s::UUID, %(embedding_m2)s, %(document_m2)s, %(cmetadata_m2)s), (%(id_m3)s, %(collection_id_m3)s::UUID, %(embedding_m3)s, %(document_m3)s, %(cmetadata_m3)s) ON CONFLICT (id) DO UPDATE SET embedding = excluded.embedding, document = excluded.document, cmetadata = excluded.cmetadata]
[parameters: [{}]]
2025-10-04 17:21:05 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 17:21:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 17:48:41 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 874, in rollback
    self.await_(self._transaction.rollback())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 227, in rollback
    await self.__rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 206, in __rollback
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1119, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 692, in do_rollback
    dbapi_connection.rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 876, in rollback
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 714, in __aexit__
    raise exc_details[1]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 697, in __aexit__
    cb_suppress = await cb(*exc_details)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 206, in __aexit__
    await anext(self.gen)
  File "E:\workspace-py\hr-agent\backend\app\core\database.py", line 54, in get_db
    await session.close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1027, in close
    await greenlet_spawn(self.sync_session.close)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2468, in close
    self._close_impl(invalidate=False)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2537, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 1362, in close
    transaction.close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2576, in close
    self._do_close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2714, in _do_close
    self._close_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2700, in _close_impl
    self._connection_rollback_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2692, in _connection_rollback_impl
    self.connection._rollback_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1121, in _rollback_impl
    self._handle_dbapi_exception(e, None, None, None, None)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1119, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 692, in do_rollback
    dbapi_connection.rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 876, in rollback
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
(Background on this error at: https://sqlalche.me/e/20/dbapi)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-04 17:51:59 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 17:51:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 17:52:02 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 17:52:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 17:52:02 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 17:52:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 17:59:22 - app.services.user_service - ERROR - user_service - get_user - Error getting user d75fcecf-253b-4450-b626-7a3e8490d0da: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 17:59:22 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 17:59:22 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 18:07:38 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 18:07:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 18:07:38 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 18:07:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 18:10:48 - app.services.user_service - ERROR - user_service - get_user - Error getting user d75fcecf-253b-4450-b626-7a3e8490d0da: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 18:10:48 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 18:10:48 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('d75fcecf-253b-4450-b626-7a3e8490d0da'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 18:25:43 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-04 18:25:43 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-04 18:26:04 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 18:26:04 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-04 18:26:04 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-04 18:26:04 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 10:37:10 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-05 10:37:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-05 10:37:31 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 10:37:31 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 10:37:31 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 10:37:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-05 12:01:32 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username admin: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 12:01:32 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-05 12:01:32 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-05 12:01:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-07 10:38:00 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 10:38:00 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 10:38:00 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-07 10:49:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-10 16:07:23 - app.services.resume_evaluation_service - ERROR - resume_evaluation_service - get_evaluation_history - 峰璇浠峰插け璐: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column resume_evaluations.status does not exist
[SQL: SELECT resume_evaluations.original_filename, resume_evaluations.file_path, resume_evaluations.file_type, resume_evaluations.file_size, resume_evaluations.resume_content, resume_evaluations.candidate_name, resume_evaluations.candidate_position, resume_evaluations.candidate_age, resume_evaluations.candidate_gender, resume_evaluations.work_years, resume_evaluations.education_level, resume_evaluations.school, resume_evaluations.total_score, resume_evaluations.evaluation_metrics, resume_evaluations.status, resume_evaluations.job_description_id, resume_evaluations.scoring_criteria_id, resume_evaluations.conversation_id, resume_evaluations.ai_response, resume_evaluations.user_id, resume_evaluations.id, resume_evaluations.created_at, resume_evaluations.updated_at, resume_evaluations.is_active, resume_evaluations.created_by, resume_evaluations.updated_by 
FROM resume_evaluations 
WHERE resume_evaluations.user_id = $1::UUID ORDER BY resume_evaluations.created_at DESC 
 LIMIT $2::INTEGER OFFSET $3::INTEGER]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'), 20, 0)]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-10-10 16:11:35 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:11:35 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:11:35 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:11:35 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 16:11:35 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 16:11:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 16:11:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 16:11:54 - app.core.logging - ERROR - hr_workflows - list_job_descriptions - Error listing JDs: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:11:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰JD琛ㄥけ璐: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT count(*) AS count_1 
FROM (SELECT job_descriptions.title AS title, job_descriptions.department AS department, job_descriptions.location AS location, job_descriptions.salary_range AS salary_range, job_descriptions.experience_level AS experience_level, job_descriptions.education AS education, job_descriptions.job_type AS job_type, job_descriptions.skills AS skills, job_descriptions.content AS content, job_descriptions.requirements AS requirements, job_descriptions.status AS status, job_descriptions.meta_data AS meta_data, job_descriptions.conversation_id AS conversation_id, job_descriptions.workflow_type AS workflow_type, job_descriptions.user_id AS user_id, job_descriptions.id AS id, job_descriptions.created_at AS created_at, job_descriptions.updated_at AS updated_at, job_descriptions.is_active AS is_active, job_descriptions.created_by AS created_by, job_descriptions.updated_by AS updated_by 
FROM job_descriptions 
WHERE job_descriptions.user_id = $1::UUID AND job_descriptions.is_active = true) AS anon_1]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:11:54 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 874, in rollback
    self.await_(self._transaction.rollback())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 227, in rollback
    await self.__rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 206, in __rollback
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1119, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 692, in do_rollback
    dbapi_connection.rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 876, in rollback
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 714, in __aexit__
    raise exc_details[1]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 697, in __aexit__
    cb_suppress = await cb(*exc_details)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 206, in __aexit__
    await anext(self.gen)
  File "E:\workspace-py\hr-agent\backend\app\core\database.py", line 54, in get_db
    await session.close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1027, in close
    await greenlet_spawn(self.sync_session.close)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2468, in close
    self._close_impl(invalidate=False)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2537, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 1362, in close
    transaction.close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2576, in close
    self._do_close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2714, in _do_close
    self._close_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2700, in _close_impl
    self._connection_rollback_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2692, in _connection_rollback_impl
    self.connection._rollback_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1121, in _rollback_impl
    self._handle_dbapi_exception(e, None, None, None, None)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1119, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 692, in do_rollback
    dbapi_connection.rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 876, in rollback
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
(Background on this error at: https://sqlalche.me/e/20/dbapi)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 83, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-10 16:21:18 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:21:18 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:21:18 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:21:23 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:21:23 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:21:23 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:21:52 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-10 16:21:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-10 16:33:47 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:33:47 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:47:16 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:47:16 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 16:47:16 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-10 18:06:19 - app.core.logging - ERROR - hr_workflows - generate_interview_plan_by_resume - Error generating interview plan by resume: 'ResumeEvaluation' object has no attribute 'content'
2025-10-10 18:06:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: ㈣规澶辫触: 'ResumeEvaluation' object has no attribute 'content'
2025-10-10 18:06:37 - app.core.logging - ERROR - hr_workflows - generate_interview_plan_by_resume - Error generating interview plan by resume: 'ResumeEvaluation' object has no attribute 'content'
2025-10-10 18:06:37 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: ㈣规澶辫触: 'ResumeEvaluation' object has no attribute 'content'
2025-10-10 18:07:15 - app.core.logging - ERROR - hr_workflows - generate_interview_plan_by_resume - Error generating interview plan by resume: 'ResumeEvaluation' object has no attribute 'content'
2025-10-10 18:07:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: ㈣规澶辫触: 'ResumeEvaluation' object has no attribute 'content'
2025-10-11 09:28:20 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 09:28:20 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 09:28:20 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-11 09:28:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-11 09:53:28 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 09:53:28 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 09:53:28 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-11 17:47:19 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 400 - b'{"code": "invalid_param", "message": "exam_1760176037632 is not a valid uuid.", "params": "conversation_id"}\n'
2025-10-11 17:47:19 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 17:47:19 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 21:17:24 - app.core.logging - ERROR - dify_service - call_workflow_stream - Dify API error: 404 - b'{"code": "not_found", "message": "Conversation Not Exists.", "status": 404}\n'
2025-10-11 21:17:24 - app.core.logging - ERROR - dify_service - call_workflow_stream - Unexpected error in Dify workflow call: 
2025-10-11 21:17:24 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 69, in app
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\hr_workflows.py", line 1141, in generate_stream
    async for chunk in dify_service.call_workflow_stream(
  File "E:\workspace-py\hr-agent\backend\app\services\dify_service.py", line 109, in call_workflow_stream
    raise HTTPException(status_code=500, detail=f"Internal server error: {str(e)}")
fastapi.exceptions.HTTPException

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-11 21:33:00 - app.core.exception_handlers - ERROR - exception_handlers - generic_exception_handler - Unhandled Exception: Caught handled exception, but response already started.
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 874, in rollback
    self.await_(self._transaction.rollback())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 227, in rollback
    await self.__rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 206, in __rollback
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1119, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 692, in do_rollback
    dbapi_connection.rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 876, in rollback
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 714, in __aexit__
    raise exc_details[1]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 697, in __aexit__
    cb_suppress = await cb(*exc_details)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\contextlib.py", line 206, in __aexit__
    await anext(self.gen)
  File "E:\workspace-py\hr-agent\backend\app\core\database.py", line 54, in get_db
    await session.close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1027, in close
    await greenlet_spawn(self.sync_session.close)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2468, in close
    self._close_impl(invalidate=False)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2537, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 1362, in close
    transaction.close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2576, in close
    self._do_close()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2714, in _do_close
    self._close_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2700, in _close_impl
    self._connection_rollback_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2692, in _connection_rollback_impl
    self.connection._rollback_impl()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1121, in _rollback_impl
    self._handle_dbapi_exception(e, None, None, None, None)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1119, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 692, in do_rollback
    dbapi_connection.rollback()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 876, in rollback
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
(Background on this error at: https://sqlalche.me/e/20/dbapi)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 109, in __call__
    await response(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\anyio\_backends\_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 273, in wrap
    await func()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 134, in stream_response
    return await super().stream_response(send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 98, in body_stream
    raise app_exc
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 83, in __call__
    raise RuntimeError(msg) from exc
RuntimeError: Caught handled exception, but response already started.
2025-10-12 09:39:45 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 09:39:45 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 09:42:12 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 09:42:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 09:42:12 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 09:42:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 10:14:52 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 10:14:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 10:14:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 10:14:52 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 10:15:12 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:15:12 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:15:12 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 10:15:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 10:21:30 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 10:21:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 10:32:26 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:32:26 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:32:26 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:32:35 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:32:35 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:32:35 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:46:06 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 10:46:06 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 10:46:07 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 10:46:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 10:46:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 10:54:45 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:45 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:45 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:48 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:48 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:48 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:54:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 10:58:01 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 10:58:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 10:58:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 10:58:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 11:01:57 - app.core.logging - ERROR - dify_service - call_workflow_sync - Dify API error: 404 - {"code": "not_found", "message": "Conversation Not Exists.", "status": 404}

2025-10-12 11:01:57 - app.core.logging - ERROR - dify_service - call_workflow_sync - Unexpected error in Dify workflow call: 
2025-10-12 11:01:57 - app.core.logging - ERROR - hr_workflows - generate_exam - Error generating exam: 
2025-10-12 11:01:57 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇峰け璐: 
2025-10-12 11:02:08 - app.core.logging - ERROR - dify_service - call_workflow_sync - Dify API error: 404 - {"code": "not_found", "message": "Conversation Not Exists.", "status": 404}

2025-10-12 11:02:08 - app.core.logging - ERROR - dify_service - call_workflow_sync - Unexpected error in Dify workflow call: 
2025-10-12 11:02:08 - app.core.logging - ERROR - hr_workflows - generate_exam - Error generating exam: 
2025-10-12 11:02:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇峰け璐: 
2025-10-12 11:12:47 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:12:47 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:12:47 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:16:45 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 11:16:45 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 11:17:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 11:38:07 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 11:38:07 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 11:38:09 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 11:38:29 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:38:29 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:38:29 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 11:38:29 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 11:38:34 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:38:34 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:38:34 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:49:08 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 11:49:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 11:51:38 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:38 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:38 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:43 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:43 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:43 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 11:51:43 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 11:51:46 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:46 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:51:46 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:56:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:56:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 11:56:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:05:27 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:05:27 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:05:27 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:11:42 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:11:42 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:11:42 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:24:05 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:24:05 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 12:24:05 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 12:24:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 13:27:12 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 13:27:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 13:27:12 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 13:27:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 13:27:33 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:27:33 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:27:33 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 13:27:33 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 13:27:36 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 13:27:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 13:27:36 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 13:27:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 13:32:51 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:32:51 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:32:51 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:41:57 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:41:57 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:41:57 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:49:30 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:49:30 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:49:30 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:59:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 13:59:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 13:59:40 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:59:40 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 13:59:40 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 13:59:40 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 14:13:28 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 14:13:28 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 14:13:28 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 14:13:34 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 14:13:34 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 14:13:34 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:12:54 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 17:12:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 17:12:54 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 17:12:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 17:13:00 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 17:13:00 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 17:13:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 17:13:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 17:13:36 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:13:36 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:13:36 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 17:13:36 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 17:22:01 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 17:41:40 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:41:40 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:41:40 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:41:50 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:41:50 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:41:50 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 17:45:11 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 17:45:11 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 18:07:19 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 18:07:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 18:07:19 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 18:07:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 18:15:55 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 18:15:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 18:15:55 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 18:15:55 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 18:42:25 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:42:25 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 18:42:25 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 19:05:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-12 19:11:39 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 19:11:39 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 19:11:39 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 19:19:58 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 19:19:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 19:19:58 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 19:19:58 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 20:14:19 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 20:14:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 20:14:19 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 20:14:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 20:14:23 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 20:14:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 20:14:23 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 20:14:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-12 20:14:46 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 20:14:46 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-12 20:14:46 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-12 20:14:46 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-12 20:53:19 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-12 20:53:19 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 09:18:44 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:18:44 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:18:44 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:20:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 09:20:16 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 09:21:03 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:21:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:37:28 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:37:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:37:54 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:37:54 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:40:30 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:40:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:41:47 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:41:47 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:42:03 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:42:03 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:43:31 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:43:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:46:18 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:46:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:49:02 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:49:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.DataError'>: invalid input for query argument $1: 'results' (invalid UUID 'results': length must be between 32..36 characters, got 7)
[SQL: SELECT exams.title, exams.subject, exams.description, exams.difficulty, exams.duration, exams.total_score, exams.question_types, exams.question_counts, exams.knowledge_files, exams.special_requirements, exams.content, exams.id, exams.created_at, exams.updated_at, exams.is_active, exams.created_by, exams.updated_by 
FROM exams 
WHERE exams.id = $1::UUID]
[parameters: ('results',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 09:54:10 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 09:54:10 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 09:58:12 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 09:58:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 09:58:12 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 09:58:12 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 10:09:31 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:09:31 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:09:31 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:09:59 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:10:05 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:11:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 璇蜂瀛
2025-10-13 10:19:38 - app.core.logging - ERROR - hr_workflows - get_exam_detail - Error getting exam detail: Mapped class Mapper[Exam(exams)] does not apply to any of the root entities in this query, e.g. Mapper[ExamResult(exam_results)]. Please specify the full path from one of the root entities to the target attribute. 
2025-10-13 10:19:38 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇疯澶辫触: Mapped class Mapper[Exam(exams)] does not apply to any of the root entities in this query, e.g. Mapper[ExamResult(exam_results)]. Please specify the full path from one of the root entities to the target attribute. 
2025-10-13 10:23:47 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Method Not Allowed
2025-10-13 10:30:54 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:30:55 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:31:08 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:31:08 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:35:59 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 10:35:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 10:36:00 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 10:36:00 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 10:36:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:08 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:14 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:15 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:22 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:23 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:31 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:39 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:45 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:45 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:36:59 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:05 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:06 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:13 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:13 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:21 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:37:28 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Not authenticated
2025-10-13 10:42:24 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:42:24 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:42:24 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-13 10:42:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-13 10:42:33 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:49:02 - app.core.logging - ERROR - hr_workflows - get_exam_result - Error getting exam result: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exam_results.exam_id, exam_results.exam_name, exam_results.student_name, exam_results.department, exam_results.total_possible_score, exam_results.total_actual_score, exam_results.exam_data, exam_results.submit_time, exam_results.status, exam_results.id, exam_results.created_at, exam_results.updated_at, exam_results.is_active, exam_results.created_by, exam_results.updated_by 
FROM exam_results 
WHERE exam_results.id = $1::UUID]
[parameters: ('f8683c60-08af-4d0c-bb9c-691b7131d186',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:49:02 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇缁澶辫触: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT exam_results.exam_id, exam_results.exam_name, exam_results.student_name, exam_results.department, exam_results.total_possible_score, exam_results.total_actual_score, exam_results.exam_data, exam_results.submit_time, exam_results.status, exam_results.id, exam_results.created_at, exam_results.updated_at, exam_results.is_active, exam_results.created_by, exam_results.updated_by 
FROM exam_results 
WHERE exam_results.id = $1::UUID]
[parameters: ('f8683c60-08af-4d0c-bb9c-691b7131d186',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 10:52:21 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:52:33 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 10:52:43 - app.core.exception_handlers - ERROR - exception_handlers - starlette_http_exception_handler - Starlette HTTP Exception: Not Found
2025-10-13 11:04:20 - app.core.logging - ERROR - hr_workflows - get_exam_result - Error getting exam result: 'NoneType' object has no attribute 'get'
2025-10-13 11:04:20 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇缁澶辫触: 'NoneType' object has no attribute 'get'
2025-10-13 11:04:24 - app.core.logging - ERROR - hr_workflows - get_exam_result - Error getting exam result: 'NoneType' object has no attribute 'get'
2025-10-13 11:04:24 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: 峰璇缁澶辫触: 'NoneType' object has no attribute 'get'
2025-10-13 11:16:18 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 11:16:18 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 11:16:30 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 11:16:30 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 11:34:02 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 11:34:02 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 11:34:02 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\futures.py", line 285, in __await__
    yield self  # This tells Task to wait for completion.
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\tasks.py", line 304, in __wakeup
    future.result()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\futures.py", line 201, in result
    raise self._exception.with_traceback(self._exception_tb)
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:16:32 - app.services.user_service - ERROR - user_service - get_user_by_username - Error getting user by username testuser: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:16:32 - app.services.user_service - ERROR - user_service - authenticate - Error authenticating user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.username = $1::VARCHAR AND users.is_active = true]
[parameters: ('testuser',)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:16:32 - app.api.v1.endpoints.auth - ERROR - auth - login - Login error: 
Traceback (most recent call last):
  File "E:\workspace-py\hr-agent\backend\app\api\v1\endpoints\auth.py", line 73, in login
    raise HTTPException(
fastapi.exceptions.HTTPException
2025-10-13 14:16:32 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Incorrect username or password
2025-10-13 14:26:40 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:26:40 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:26:40 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:26:46 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:26:46 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 14:26:46 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:06:17 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 15:06:17 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 15:07:22 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:22 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:22 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:25 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:25 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:25 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:29 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:29 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:07:29 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:01 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:01 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:01 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:19 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:19 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:19 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:19 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:19 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:19 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:12:35 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 15:12:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 15:12:35 - app.api.deps - ERROR - deps - get_current_user -  JWT decode error: Signature has expired.
2025-10-13 15:12:35 - app.core.exception_handlers - ERROR - exception_handlers - http_exception_handler - HTTP Exception: Could not validate credentials
2025-10-13 15:23:59 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:23:59 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:23:59 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:23:59 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:23:59 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:23:59 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:00 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:00 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:00 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:07 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:07 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:07 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:07 - app.services.user_service - ERROR - user_service - get_user - Error getting user 663c3a32-596c-4fec-955e-6eace86eb281: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:07 - app.api.deps - ERROR - deps - get_current_user -  Error in get_current_user: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
2025-10-13 15:24:07 - app.core.exception_handlers - ERROR - exception_handlers - sqlalchemy_exception_handler - Database Error: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\asyncio\selector_events.py", line 862, in _read_ready__data_received
    data = self._sock.recv(self.max_size)
ConnectionResetError: [WinError 10054] 杩绋涓绘哄己杩抽浜涓涓版杩ャ

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 859, in _start_transaction
    await self._transaction.start()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\asyncpg\connection.py", line 350, in execute
    result = await self._protocol.query(query, timeout)
  File "asyncpg\protocol\protocol.pyx", line 374, in query
asyncpg.exceptions.ConnectionDoesNotExistError: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\routing.py", line 264, in app
    solved_result = await solve_dependencies(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\fastapi\dependencies\utils.py", line 592, in solve_dependencies
    solved = await call(**sub_values)
  File "E:\workspace-py\hr-agent\backend\app\api\deps.py", line 56, in get_current_user
    user = await user_service.get_user(user_uuid)
  File "E:\workspace-py\hr-agent\backend\app\services\user_service.py", line 112, in get_user
    result = await self.db.execute(query)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 591, in execute
    self._adapt_connection.await_(
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 527, in _prepare_and_execute
    await adapt_connection._start_transaction()
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 861, in _start_transaction
    self._handle_exception(error)
  File "D:\ProgramData\Anaconda3\envs\python310\lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 808, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.ConnectionDoesNotExistError'>: connection was closed in the middle of operation
[SQL: SELECT users.username, users.email, users.full_name, users.hashed_password, users.phone, users.department, users.position, users.employee_id, users.role, users.is_superuser, users.is_verified, users.bio, users.avatar_url, users.last_login, users.id, users.created_at, users.updated_at, users.is_active, users.created_by, users.updated_by 
FROM users 
WHERE users.id = $1::UUID AND users.is_active = true]
[parameters: (UUID('663c3a32-596c-4fec-955e-6eace86eb281'),)]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
